{"version":3,"names":["_react","require","_reactWindow","_lodash","_choicesContext","_choiceWrapper","_interopRequireDefault","_choiceRow","_dragDropContext","_droppable","_generateChoiceId","ChoicesInserter","_ref","choices","setChoices","withAttachment","labelChangeHandler","val","index","$choices","cloneDeep","label","addChoice","at","splice","value","generateChoiceId","deleteChoice","newChoices","filter","choice","deleteImageHandler","imageUrl","undefined","handleMediaUpload","media","url","context","_element","createElement","default","onDragEnd","result","source","destination","sourceIndex","destinationIndex","output","Array","from","removed","ChoiceContextProvider","useMemo","Object","values","droppableId","mode","renderClone","provided","_snapshot","rubric","_extends2","draggableProps","dragHandleProps","ref","innerRef","style","zIndex","snapshot","itemCount","isUsingPlaceholder","length","droppableProps","FixedSizeList","className","outerRef","height","width","itemSize","itemData","ChoiceWrapper","_default","exports"],"sources":["@quillforms/admin-components/src/choices-inserter/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { useMemo } from 'react';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { FixedSizeList as List } from 'react-window';\r\nimport { cloneDeep } from 'lodash';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { ChoiceContextProvider } from './choices-context';\r\nimport ChoiceWrapper from './choice-wrapper';\r\nimport ChoiceRow from './choice-row';\r\nimport __experimentalDragDropContext from '../drag-drop-context';\r\nimport __experimentalDroppable from '../droppable';\r\nimport generateChoiceId from './generate-choice-id';\r\nimport type { Choices } from '../choices-bulk-btn/types';\r\n\r\ninterface Props {\r\n\tchoices: Choices;\r\n\tsetChoices: ( choices: Choices ) => void;\r\n\twithAttachment: boolean;\r\n}\r\nconst ChoicesInserter: React.FC< Props > = ( {\r\n\tchoices,\r\n\tsetChoices,\r\n\twithAttachment,\r\n} ) => {\r\n\tconst labelChangeHandler = ( val: string, index: number ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices[ index ] = { ...$choices[ index ], label: val };\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\r\n\tconst addChoice = ( at: number ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices.splice( at, 0, {\r\n\t\t\tvalue: generateChoiceId(),\r\n\t\t\tlabel: '',\r\n\t\t} );\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\r\n\tconst deleteChoice = ( value: string ) => {\r\n\t\tconst newChoices = cloneDeep( choices ).filter(\r\n\t\t\t( choice ) => choice.value !== value\r\n\t\t);\r\n\t\tsetChoices( newChoices );\r\n\t};\r\n\r\n\tconst deleteImageHandler = ( index ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices[ index ].imageUrl = undefined;\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\tconst handleMediaUpload = ( media, index ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices[ index ].imageUrl = media.url;\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\r\n\tconst context = {\r\n\t\taddChoice,\r\n\t\tlabelChangeHandler,\r\n\t\tdeleteChoice,\r\n\t\tdeleteImageHandler,\r\n\t\thandleMediaUpload,\r\n\t\twithAttachment,\r\n\t};\r\n\r\n\treturn (\r\n\t\t<__experimentalDragDropContext\r\n\t\t\tonDragEnd={ ( result ) => {\r\n\t\t\t\tconst { source, destination } = result;\r\n\t\t\t\tif (\r\n\t\t\t\t\t! result.destination ||\r\n\t\t\t\t\tresult.source.index === result.destination.index\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst sourceIndex = source.index;\r\n\t\t\t\tconst destinationIndex = destination?.index;\r\n\t\t\t\tconst $choices = [ ...choices ];\r\n\t\t\t\tconst output = Array.from( $choices );\r\n\t\t\t\tconst [ removed ] = output.splice( sourceIndex, 1 );\r\n\t\t\t\tif ( destinationIndex !== undefined ) {\r\n\t\t\t\t\toutput.splice( destinationIndex, 0, removed );\r\n\t\t\t\t\tsetChoices( output );\r\n\t\t\t\t}\r\n\t\t\t} }\r\n\t\t>\r\n\t\t\t<ChoiceContextProvider\r\n\t\t\t\t// It is important to return the same object if props haven't\r\n\t\t\t\t// changed to avoid  unnecessary rerenders.\r\n\t\t\t\t// See https://reactjs.org/docs/context.html#caveats.\r\n\t\t\t\tvalue={ useMemo( () => context, Object.values( context ) ) }\r\n\t\t\t>\r\n\t\t\t\t<__experimentalDroppable\r\n\t\t\t\t\tdroppableId=\"CHOICES_DROP_AREA\"\r\n\t\t\t\t\tmode=\"virtual\"\r\n\t\t\t\t\trenderClone={ ( provided, _snapshot, rubric ) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t{ ...provided.draggableProps }\r\n\t\t\t\t\t\t\t\t{ ...provided.dragHandleProps }\r\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\r\n\t\t\t\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\t\t\t\t...provided.draggableProps.style,\r\n\t\t\t\t\t\t\t\t\tzIndex: 111111111,\r\n\t\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<ChoiceRow\r\n\t\t\t\t\t\t\t\t\tchoices={ choices }\r\n\t\t\t\t\t\t\t\t\tindex={ rubric.source.index }\r\n\t\t\t\t\t\t\t\t\tprovided={ provided }\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ ( provided, snapshot ) => {\r\n\t\t\t\t\t\tconst itemCount = snapshot.isUsingPlaceholder\r\n\t\t\t\t\t\t\t? choices.length + 1\r\n\t\t\t\t\t\t\t: choices.length;\r\n\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\r\n\t\t\t\t\t\t\t\t{ ...provided.droppableProps }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<List\r\n\t\t\t\t\t\t\t\t\tclassName=\"admin-components-choices-inserter__choices-wrapper\"\r\n\t\t\t\t\t\t\t\t\touterRef={ provided.innerRef }\r\n\t\t\t\t\t\t\t\t\theight={ 250 }\r\n\t\t\t\t\t\t\t\t\twidth={ '100%' }\r\n\t\t\t\t\t\t\t\t\titemCount={ itemCount }\r\n\t\t\t\t\t\t\t\t\titemSize={ 54 }\r\n\t\t\t\t\t\t\t\t\titemData={ choices }\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{ ChoiceWrapper }\r\n\t\t\t\t\t\t\t\t</List>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} }\r\n\t\t\t\t</__experimentalDroppable>\r\n\t\t\t</ChoiceContextProvider>\r\n\t\t</__experimentalDragDropContext>\r\n\t);\r\n};\r\n\r\nexport default ChoicesInserter;\r\n"],"mappings":"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"}