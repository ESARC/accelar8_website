{"version":3,"names":["_react","require","_mappingRow","_interopRequireDefault","MappingList","_ref","sections","options","initial","onChange","initialMappingRows","useMemo","result","key","value","Object","entries","push","option","required","find","item","length","mappingRows","setMappingRows","useState","selectedKeys","map","row","useEffect","fields","type","_element","createElement","fieldRow","index","default","keyProps","filter","includes","state","newState","disabled","valueProps","customize","combobox","onAddClick","splice","onRemoveClick","undefined","_default","exports"],"sources":["@quillforms/admin-components/src/mapping-list/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { Option, Sections } from '../mapping-row/key-control';\r\nimport { CustomizeFunction } from '../combobox-control';\r\nimport { useState, useEffect, useMemo } from 'react';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport MappingRow from '../mapping-row';\r\n\r\ntype Options = ( Option & {\r\n\trequired?: boolean; // makes the option disabled and added by default.\r\n\tcombobox?: {\r\n\t\tcustomize?: CustomizeFunction;\r\n\t};\r\n} )[];\r\n\r\ntype MappingRowValue = {\r\n\tkey: string;\r\n\tvalue: {\r\n\t\ttype?: string;\r\n\t\tvalue?: string;\r\n\t};\r\n};\r\n\r\ntype Fields = {\r\n\t[ key: string ]: { type: string; value: string };\r\n};\r\n\r\ninterface Props {\r\n\tsections?: Sections; // key sections.\r\n\toptions?: Options; // key options.\r\n\tinitial?: Fields; // used for setup initial mapping rows state.\r\n\tonChange: ( fields: Fields ) => void; // fields contain only the data of valid rows.\r\n}\r\n\r\nconst MappingList: React.FC< Props > = ( {\r\n\tsections,\r\n\toptions,\r\n\tinitial,\r\n\tonChange,\r\n} ) => {\r\n\t// initial mapping rows.\r\n\tconst initialMappingRows: MappingRowValue[] = useMemo( () => {\r\n\t\tconst result: MappingRowValue[] = [];\r\n\t\t// first add the initial fields.\r\n\t\tfor ( const [ key, value ] of Object.entries( initial ?? {} ) ) {\r\n\t\t\tresult.push( {\r\n\t\t\t\tkey,\r\n\t\t\t\tvalue,\r\n\t\t\t} );\r\n\t\t}\r\n\t\t// then add the required options.\r\n\t\tfor ( const option of options ?? [] ) {\r\n\t\t\tif (\r\n\t\t\t\toption.required &&\r\n\t\t\t\t! result.find( ( item ) => item.key === option.value )\r\n\t\t\t) {\r\n\t\t\t\tresult.push( {\r\n\t\t\t\t\tkey: option.value,\r\n\t\t\t\t\tvalue: {},\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t\t// add an empty option if there is no options added.\r\n\t\tif ( result.length === 0 ) {\r\n\t\t\tresult.push( {\r\n\t\t\t\tkey: '',\r\n\t\t\t\tvalue: {},\r\n\t\t\t} );\r\n\t\t}\r\n\t\treturn result;\r\n\t}, [] );\r\n\r\n\t// mapping rows state.\r\n\tconst [ mappingRows, setMappingRows ] =\r\n\t\tuseState< MappingRowValue[] >( initialMappingRows );\r\n\tconst selectedKeys = mappingRows.map( ( row ) => row.key );\r\n\r\n\t// call onChange\r\n\tuseEffect( () => {\r\n\t\tconst fields = {};\r\n\t\tfor ( const { key, value } of mappingRows ) {\r\n\t\t\tif ( key && value.type && value.value ) {\r\n\t\t\t\tfields[ key ] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t\tonChange( fields );\r\n\t}, [ mappingRows ] );\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t{ mappingRows.map( ( fieldRow, index ) => {\r\n\t\t\t\tconst option = options?.find(\r\n\t\t\t\t\t( option ) => option.value === fieldRow.key\r\n\t\t\t\t);\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<MappingRow\r\n\t\t\t\t\t\tkey={ index }\r\n\t\t\t\t\t\tkeyProps={ {\r\n\t\t\t\t\t\t\tsections: sections,\r\n\t\t\t\t\t\t\toptions: options?.filter(\r\n\t\t\t\t\t\t\t\t( option ) =>\r\n\t\t\t\t\t\t\t\t\toption.value === fieldRow.key ||\r\n\t\t\t\t\t\t\t\t\t! selectedKeys.includes( option.value )\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\tvalue: fieldRow.key,\r\n\t\t\t\t\t\t\tonChange: ( key ) => {\r\n\t\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\t\tnewState[ index ] = {\r\n\t\t\t\t\t\t\t\t\t\tkey,\r\n\t\t\t\t\t\t\t\t\t\tvalue: {},\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tdisabled: option?.required,\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tvalueProps={ {\r\n\t\t\t\t\t\t\tvalue: fieldRow.value,\r\n\t\t\t\t\t\t\tonChange: ( value ) => {\r\n\t\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\t\tnewState[ index ].value = value;\r\n\t\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcustomize: option?.combobox?.customize,\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tonAddClick={ () => {\r\n\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\tnewState.splice( index + 1, 0, {\r\n\t\t\t\t\t\t\t\t\tkey: '',\r\n\t\t\t\t\t\t\t\t\tvalue: {},\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tonRemoveClick={\r\n\t\t\t\t\t\t\toption?.required || mappingRows.length === 1\r\n\t\t\t\t\t\t\t\t? undefined\r\n\t\t\t\t\t\t\t\t: () => {\r\n\t\t\t\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\t\t\t\tnewState.splice( index, 1 );\r\n\t\t\t\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t} ) }\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default MappingList;\r\n"],"mappings":"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"}