{"version":3,"names":["_slate","require","_isUrl","_interopRequireDefault","isLinkActive","editor","link","Editor","nodes","match","n","type","unwrapLink","Transforms","unwrapNodes","wrapLink","url","selection","isCollapsed","Range","children","text","insertNodes","wrapNodes","split","collapse","edge","withLinks","insertData","insertText","isInline","element","isUrl","data","getData","exports"],"sources":["@quillforms/admin-components/src/rich-text/plugins/with-links.ts"],"sourcesContent":["import { Transforms, Editor, Range } from 'slate';\r\nimport isUrl from 'is-url';\r\nimport { CustomEditor, CustomNode } from '../types';\r\n\r\nconst isLinkActive = ( editor ) => {\r\n\tconst [ link ] = Editor.nodes( editor, {\r\n\t\tmatch: ( n: CustomNode ) => n.type === 'link',\r\n\t} );\r\n\treturn !! link;\r\n};\r\n\r\nconst unwrapLink = ( editor: CustomEditor ) => {\r\n\tTransforms.unwrapNodes( editor, {\r\n\t\tmatch: ( n: CustomNode ) => n.type === 'link',\r\n\t} );\r\n};\r\n\r\nconst wrapLink = ( editor, url: string ) => {\r\n\tif ( isLinkActive( editor ) ) {\r\n\t\tunwrapLink( editor );\r\n\t}\r\n\r\n\tconst { selection } = editor;\r\n\tconst isCollapsed = selection && Range.isCollapsed( selection );\r\n\tconst link = {\r\n\t\ttype: 'link',\r\n\t\turl,\r\n\t\tchildren: isCollapsed ? [ { text: url } ] : [],\r\n\t};\r\n\r\n\tif ( isCollapsed ) {\r\n\t\tTransforms.insertNodes( editor, link );\r\n\t} else {\r\n\t\tTransforms.wrapNodes( editor, link, { split: true } );\r\n\t\tTransforms.collapse( editor, { edge: 'end' } );\r\n\t}\r\n};\r\n\r\nexport const withLinks = ( editor ) => {\r\n\tconst { insertData, insertText, isInline } = editor;\r\n\r\n\teditor.isInline = ( element ) => {\r\n\t\treturn element.type === 'link' ? true : isInline( element );\r\n\t};\r\n\r\n\teditor.insertText = ( text ) => {\r\n\t\tif ( text && isUrl( text ) ) {\r\n\t\t\twrapLink( editor, text );\r\n\t\t} else {\r\n\t\t\tinsertText( text );\r\n\t\t}\r\n\t};\r\n\r\n\teditor.insertData = ( data ) => {\r\n\t\tconst text = data.getData( 'text/plain' );\r\n\r\n\t\tif ( text && isUrl( text ) ) {\r\n\t\t\twrapLink( editor, text );\r\n\t\t} else {\r\n\t\t\tinsertData( data );\r\n\t\t}\r\n\t};\r\n\r\n\treturn editor;\r\n};\r\n"],"mappings":";;;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAC,sBAAA,CAAAF,OAAA;AAGA,MAAMG,YAAY,GAAKC,MAAM,IAAM;EAClC,MAAM,CAAEC,IAAI,CAAE,GAAGC,aAAM,CAACC,KAAK,CAAEH,MAAM,EAAE;IACtCI,KAAK,EAAIC,CAAa,IAAMA,CAAC,CAACC,IAAI,KAAK;EACxC,CAAC,CAAE;EACH,OAAO,CAAC,CAAEL,IAAI;AACf,CAAC;AAED,MAAMM,UAAU,GAAKP,MAAoB,IAAM;EAC9CQ,iBAAU,CAACC,WAAW,CAAET,MAAM,EAAE;IAC/BI,KAAK,EAAIC,CAAa,IAAMA,CAAC,CAACC,IAAI,KAAK;EACxC,CAAC,CAAE;AACJ,CAAC;AAED,MAAMI,QAAQ,GAAGA,CAAEV,MAAM,EAAEW,GAAW,KAAM;EAC3C,IAAKZ,YAAY,CAAEC,MAAM,CAAE,EAAG;IAC7BO,UAAU,CAAEP,MAAM,CAAE;EACrB;EAEA,MAAM;IAAEY;EAAU,CAAC,GAAGZ,MAAM;EAC5B,MAAMa,WAAW,GAAGD,SAAS,IAAIE,YAAK,CAACD,WAAW,CAAED,SAAS,CAAE;EAC/D,MAAMX,IAAI,GAAG;IACZK,IAAI,EAAE,MAAM;IACZK,GAAG;IACHI,QAAQ,EAAEF,WAAW,GAAG,CAAE;MAAEG,IAAI,EAAEL;IAAI,CAAC,CAAE,GAAG;EAC7C,CAAC;EAED,IAAKE,WAAW,EAAG;IAClBL,iBAAU,CAACS,WAAW,CAAEjB,MAAM,EAAEC,IAAI,CAAE;EACvC,CAAC,MAAM;IACNO,iBAAU,CAACU,SAAS,CAAElB,MAAM,EAAEC,IAAI,EAAE;MAAEkB,KAAK,EAAE;IAAK,CAAC,CAAE;IACrDX,iBAAU,CAACY,QAAQ,CAAEpB,MAAM,EAAE;MAAEqB,IAAI,EAAE;IAAM,CAAC,CAAE;EAC/C;AACD,CAAC;AAEM,MAAMC,SAAS,GAAKtB,MAAM,IAAM;EACtC,MAAM;IAAEuB,UAAU;IAAEC,UAAU;IAAEC;EAAS,CAAC,GAAGzB,MAAM;EAEnDA,MAAM,CAACyB,QAAQ,GAAKC,OAAO,IAAM;IAChC,OAAOA,OAAO,CAACpB,IAAI,KAAK,MAAM,GAAG,IAAI,GAAGmB,QAAQ,CAAEC,OAAO,CAAE;EAC5D,CAAC;EAED1B,MAAM,CAACwB,UAAU,GAAKR,IAAI,IAAM;IAC/B,IAAKA,IAAI,IAAI,IAAAW,cAAK,EAAEX,IAAI,CAAE,EAAG;MAC5BN,QAAQ,CAAEV,MAAM,EAAEgB,IAAI,CAAE;IACzB,CAAC,MAAM;MACNQ,UAAU,CAAER,IAAI,CAAE;IACnB;EACD,CAAC;EAEDhB,MAAM,CAACuB,UAAU,GAAKK,IAAI,IAAM;IAC/B,MAAMZ,IAAI,GAAGY,IAAI,CAACC,OAAO,CAAE,YAAY,CAAE;IAEzC,IAAKb,IAAI,IAAI,IAAAW,cAAK,EAAEX,IAAI,CAAE,EAAG;MAC5BN,QAAQ,CAAEV,MAAM,EAAEgB,IAAI,CAAE;IACzB,CAAC,MAAM;MACNO,UAAU,CAAEK,IAAI,CAAE;IACnB;EACD,CAAC;EAED,OAAO5B,MAAM;AACd,CAAC;AAAC8B,OAAA,CAAAR,SAAA,GAAAA,SAAA"}