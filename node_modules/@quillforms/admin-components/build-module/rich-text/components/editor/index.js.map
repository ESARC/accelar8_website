{"version":3,"names":["Fragment","useCallback","useEffect","useState","useRef","Popover","Transforms","Text","Editor","Range","Slate","Editable","ReactEditor","css","Element","HoveringToolbar","MergeTagListItem","TextEditor","props","editor","placeholder","color","onChange","value","onFocus","mergeTags","allowedFormats","wrapperRef","PopoverRef","ref","target","setTarget","index","setIndex","search","setSearch","$mergeTags","filter","c","label","toLowerCase","startsWith","isFormatActive","format","match","nodes","n","mode","renderElement","$props","createElement","_extends","toggleFormat","active","setNodes","isText","split","Leaf","_ref","attributes","children","leaf","bold","italic","insertMergeTag","mergeTag","insertNodes","type","data","modifier","text","setTimeout","move","onKeyDown","event","key","length","preventDefault","prevIndex","nextIndex","select","undefined","handleClickOutsidePortal","current","contains","document","addEventListener","removeEventListener","className","style","width","val","selection","isCollapsed","start","edges","wordBefore","before","beforeRange","range","beforeText","string","beforeMatch","endsWith","after","afterRange","afterText","afterMatch","formattingControls","renderLeaf","onDOMBeforeInput","inputType","map","i","onClick","focus","onMouseEnter","isSelected"],"sources":["@quillforms/admin-components/src/rich-text/components/editor/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { Fragment, useCallback, useEffect, useState, useRef } from 'react';\r\nimport { Popover } from '@wordpress/components';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { Transforms, Text, Editor, Range, Node as SlateNode } from 'slate';\r\nimport { Slate, Editable, ReactEditor, RenderElementProps } from 'slate-react';\r\nimport { HistoryEditor } from 'slate-history';\r\nimport { css } from 'emotion';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport Element from '../element';\r\nimport HoveringToolbar from '../hovering-toolbar';\r\nimport MergeTagListItem from '../merge-tag-list-item';\r\nimport type {\r\n\tMergeTags,\r\n\tMergeTagsSections,\r\n\tMergeTag,\r\n\tallowedFormats,\r\n} from '../../types';\r\ninterface Props {\r\n\teditor: ReactEditor & HistoryEditor;\r\n\tplaceholder?: string;\r\n\tcolor?: string;\r\n\tvalue: SlateNode[];\r\n\tonChange: ( value: SlateNode[] ) => void;\r\n\tonFocus: React.FocusEventHandler;\r\n\tmergeTags?: MergeTags;\r\n\tmergeTagsSections?: MergeTagsSections;\r\n\tallowedFormats?: allowedFormats;\r\n}\r\nconst TextEditor: React.FC< Props > = ( props ) => {\r\n\tconst {\r\n\t\teditor,\r\n\t\tplaceholder,\r\n\t\tcolor,\r\n\t\tonChange,\r\n\t\tvalue,\r\n\t\tonFocus,\r\n\t\tmergeTags = [],\r\n\t\t// mergeTagsSections = [\r\n\t\t// \t{ key: 'field', label: 'Fields' },\r\n\t\t// \t{ key: 'variable', label: 'Variables' },\r\n\t\t// \t{ key: 'hidden_field', label: 'Hidden Fields' },\r\n\t\t// ],\r\n\t\tallowedFormats = [],\r\n\t} = props;\r\n\r\n\tconst wrapperRef = useRef< HTMLDivElement >( null );\r\n\tconst PopoverRef = useRef( null );\r\n\tconst ref = useRef< HTMLDivElement >( null );\r\n\tconst [ target, setTarget ] = useState< Range | undefined >();\r\n\tconst [ index, setIndex ] = useState( 0 );\r\n\tconst [ search, setSearch ] = useState( '' );\r\n\r\n\tconst $mergeTags = mergeTags.filter( ( c ) => {\r\n\t\tif ( search ) {\r\n\t\t\treturn c.label\r\n\t\t\t\t?.toLowerCase()\r\n\t\t\t\t.startsWith( search ? search.toLowerCase() : '' );\r\n\t\t}\r\n\t\treturn true;\r\n\t} );\r\n\r\n\tconst isFormatActive = ( format ) => {\r\n\t\tconst [ match ] = Editor.nodes( editor, {\r\n\t\t\tmatch: ( n ) => n[ format ] === true,\r\n\t\t\tmode: 'all',\r\n\t\t} );\r\n\t\treturn !! match;\r\n\t};\r\n\r\n\tconst renderElement = ( $props: RenderElementProps ) => (\r\n\t\t<Element editor={ editor } { ...$props } mergeTags={ mergeTags } />\r\n\t);\r\n\r\n\tconst toggleFormat = ( editor: Editor, format ) => {\r\n\t\tconst active = isFormatActive( format );\r\n\t\tTransforms.setNodes(\r\n\t\t\teditor,\r\n\t\t\t{ [ format ]: active ? null : true },\r\n\t\t\t{ match: Text.isText, split: true }\r\n\t\t);\r\n\t};\r\n\r\n\tconst Leaf = ( { attributes, children, leaf } ) => {\r\n\t\tif ( leaf.bold ) {\r\n\t\t\tchildren = <strong>{ children }</strong>;\r\n\t\t}\r\n\r\n\t\tif ( leaf.italic ) {\r\n\t\t\tchildren = <em>{ children }</em>;\r\n\t\t}\r\n\r\n\t\treturn <span { ...attributes }>{ children }</span>;\r\n\t};\r\n\r\n\t// Insert Variable\r\n\tconst insertMergeTag = ( mergeTag: MergeTag ) => {\r\n\t\tTransforms.insertNodes( editor, {\r\n\t\t\ttype: 'mergeTag',\r\n\t\t\tdata: {\r\n\t\t\t\ttype: mergeTag.type,\r\n\t\t\t\tmodifier: mergeTag.modifier,\r\n\t\t\t},\r\n\t\t\tchildren: [ { text: '' } ],\r\n\t\t} );\r\n\t\tsetTimeout( () => {\r\n\t\t\tTransforms.move( editor );\r\n\t\t}, 0 );\r\n\t};\r\n\r\n\tconst onKeyDown = useCallback(\r\n\t\t( event ) => {\r\n\t\t\tif ( event.key === 'Enter' && allowedFormats?.length === 0 ) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t\tif ( target ) {\r\n\t\t\t\tswitch ( event.key ) {\r\n\t\t\t\t\tcase 'ArrowDown':\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tconst prevIndex =\r\n\t\t\t\t\t\t\tindex >= $mergeTags.length - 1 ? 0 : index + 1;\r\n\t\t\t\t\t\tsetIndex( prevIndex );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'ArrowUp':\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tconst nextIndex =\r\n\t\t\t\t\t\t\tindex <= 0 ? $mergeTags.length - 1 : index - 1;\r\n\t\t\t\t\t\tsetIndex( nextIndex );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Tab':\r\n\t\t\t\t\tcase 'Enter':\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tTransforms.select( editor, target );\r\n\t\t\t\t\t\tinsertMergeTag( $mergeTags[ index ] );\r\n\t\t\t\t\t\tsetTarget( undefined );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Escape':\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tsetTarget( undefined );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t[ index, search, target ]\r\n\t);\r\n\r\n\t// useEffect( () => {\r\n\t// \tif ( target && $mergeTags.length > 0 ) {\r\n\t// \t\tconst el: HTMLDivElement | null = ref.current;\r\n\t// \t\tconst domRange = ReactEditor.toDOMRange( editor, target );\r\n\t// \t\tconst rect = domRange.getBoundingClientRect();\r\n\t// \t\tif ( el ) {\r\n\t// \t\t\tel.style.top = `${ rect.top + window.pageYOffset + 24 }px`;\r\n\t// \t\t\tel.style.left = `${ rect.left + window.pageXOffset }px`;\r\n\t// \t\t}\r\n\t// \t}\r\n\t// }, [ $mergeTags.length, editor, index, search, target ] );\r\n\r\n\tuseEffect( () => {\r\n\t\t/**\r\n\t\t * Alert if clicked on outside of element\r\n\t\t *\r\n\t\t * @param  event\r\n\t\t */\r\n\t\tfunction handleClickOutsidePortal( event: MouseEvent ): void {\r\n\t\t\tif (\r\n\t\t\t\tPopoverRef.current &&\r\n\t\t\t\tref.current &&\r\n\t\t\t\t// @ts-expect-error\r\n\t\t\t\t! PopoverRef.current.contains( event.target as Node ) &&\r\n\t\t\t\t! ref.current.contains( event.target as Node )\r\n\t\t\t) {\r\n\t\t\t\tsetTarget( undefined );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Bind the event listener\r\n\t\tdocument.addEventListener( 'mousedown', handleClickOutsidePortal );\r\n\t\treturn () => {\r\n\t\t\t// Unbind the event listener on clean up\r\n\t\t\tdocument.removeEventListener(\r\n\t\t\t\t'mousedown',\r\n\t\t\t\thandleClickOutsidePortal\r\n\t\t\t);\r\n\t\t};\r\n\t}, [ PopoverRef ] );\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"richtext__editor\"\r\n\t\t\t\tstyle={ { width: '100%' } }\r\n\t\t\t\tref={ wrapperRef }\r\n\t\t\t>\r\n\t\t\t\t<Slate\r\n\t\t\t\t\teditor={ editor }\r\n\t\t\t\t\tvalue={ value }\r\n\t\t\t\t\tonChange={ ( val ) => {\r\n\t\t\t\t\t\tonChange( val );\r\n\t\t\t\t\t\tconst { selection } = editor;\r\n\r\n\t\t\t\t\t\tif ( selection && Range.isCollapsed( selection ) ) {\r\n\t\t\t\t\t\t\tconst [ start ] = Range.edges( selection );\r\n\t\t\t\t\t\t\tconst wordBefore = selection;\r\n\t\t\t\t\t\t\tconst before =\r\n\t\t\t\t\t\t\t\twordBefore &&\r\n\t\t\t\t\t\t\t\tEditor.before( editor, wordBefore );\r\n\t\t\t\t\t\t\tconst beforeRange =\r\n\t\t\t\t\t\t\t\tbefore && Editor.range( editor, before, start );\r\n\t\t\t\t\t\t\tconst beforeText =\r\n\t\t\t\t\t\t\t\tbeforeRange &&\r\n\t\t\t\t\t\t\t\tEditor.string( editor, beforeRange );\r\n\t\t\t\t\t\t\tconst beforeMatch =\r\n\t\t\t\t\t\t\t\tbeforeText && beforeText.endsWith( '@' );\r\n\t\t\t\t\t\t\tconst after = Editor.after( editor, start );\r\n\t\t\t\t\t\t\tconst afterRange = Editor.range(\r\n\t\t\t\t\t\t\t\teditor,\r\n\t\t\t\t\t\t\t\tstart,\r\n\t\t\t\t\t\t\t\tafter\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconst afterText = Editor.string(\r\n\t\t\t\t\t\t\t\teditor,\r\n\t\t\t\t\t\t\t\tafterRange\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconst afterMatch = afterText.match( /^(\\s|$)/ );\r\n\r\n\t\t\t\t\t\t\tif ( beforeMatch && afterMatch ) {\r\n\t\t\t\t\t\t\t\tsetTarget( beforeRange );\r\n\t\t\t\t\t\t\t\tsetSearch( beforeMatch[ 1 ] );\r\n\t\t\t\t\t\t\t\tsetIndex( 0 );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsetTarget( undefined );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ allowedFormats?.length > 0 && (\r\n\t\t\t\t\t\t<HoveringToolbar\r\n\t\t\t\t\t\t\tformattingControls={ allowedFormats }\r\n\t\t\t\t\t\t\ttoggleFormat={ ( format ) =>\r\n\t\t\t\t\t\t\t\ttoggleFormat( editor, format )\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tisFormatActive={ ( format ) =>\r\n\t\t\t\t\t\t\t\tisFormatActive( format )\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t\t<Editable\r\n\t\t\t\t\t\tstyle={ { color } }\r\n\t\t\t\t\t\tcolor={ color }\r\n\t\t\t\t\t\trenderLeaf={ ( $props ) => <Leaf { ...$props } /> }\r\n\t\t\t\t\t\trenderElement={ renderElement }\r\n\t\t\t\t\t\tplaceholder={ placeholder }\r\n\t\t\t\t\t\tonFocus={ onFocus }\r\n\t\t\t\t\t\tonKeyDown={ onKeyDown }\r\n\t\t\t\t\t\tonDOMBeforeInput={ ( event: Event ) => {\r\n\t\t\t\t\t\t\tswitch ( ( event as InputEvent ).inputType ) {\r\n\t\t\t\t\t\t\t\tcase 'formatBold':\r\n\t\t\t\t\t\t\t\t\treturn toggleFormat( editor, 'bold' );\r\n\t\t\t\t\t\t\t\tcase 'formatItalic':\r\n\t\t\t\t\t\t\t\t\treturn toggleFormat( editor, 'italic' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{ target && $mergeTags.length > 0 && (\r\n\t\t\t\t\t\t<Popover\r\n\t\t\t\t\t\t\tref={ PopoverRef }\r\n\t\t\t\t\t\t\tclassName={ css`\r\n\t\t\t\t\t\t\t\tz-index: 1111111111111111111;\r\n\t\t\t\t\t\t\t\t.components-popover__content {\r\n\t\t\t\t\t\t\t\t\tpadding: 3px;\r\n\t\t\t\t\t\t\t\t\tborder: none;\r\n\t\t\t\t\t\t\t\t\tborder-radius: 4px;\r\n\t\t\t\t\t\t\t\t\tbox-shadow: 0 1px 5px rgba( 0, 0, 0, 0.2 );\r\n\t\t\t\t\t\t\t\t\tz-index: 111111111111111111;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t` }\r\n\t\t\t\t\t\t\tonKeyDown={ onKeyDown }\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName={ css`\r\n\t\t\t\t\t\t\t\t\tpadding: 5px 25px;\r\n\t\t\t\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\t\t\t` }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tRecall Information from...\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"rich-text-merge-tag-list\"\r\n\t\t\t\t\t\t\t\tref={ ref }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{ $mergeTags.map( ( mergeTag, i ) => (\r\n\t\t\t\t\t\t\t\t\t<MergeTagListItem\r\n\t\t\t\t\t\t\t\t\t\tkey={ `merge-tag-${ i }` }\r\n\t\t\t\t\t\t\t\t\t\tmergeTag={ mergeTag }\r\n\t\t\t\t\t\t\t\t\t\tonClick={ () => {\r\n\t\t\t\t\t\t\t\t\t\t\tTransforms.select( editor, target );\r\n\t\t\t\t\t\t\t\t\t\t\tinsertMergeTag( mergeTag );\r\n\t\t\t\t\t\t\t\t\t\t\tReactEditor.focus( editor );\r\n\t\t\t\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t\t\t\t\tonMouseEnter={ () => setIndex( i ) }\r\n\t\t\t\t\t\t\t\t\t\tisSelected={ index === i }\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t) ) }\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Popover>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</Slate>\r\n\t\t\t</div>\r\n\t\t</Fragment>\r\n\t);\r\n};\r\n\r\n/**\r\n * Export.\r\n */\r\nexport default TextEditor;\r\n"],"mappings":"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"}