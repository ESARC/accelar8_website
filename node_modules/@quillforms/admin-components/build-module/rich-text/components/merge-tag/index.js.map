{"version":3,"names":["useEffect","Icon","plus","close","Editor","Transforms","classnames","css","getPlainExcerpt","EditorMergeTag","_ref","attributes","editor","children","path","element","mergeTags","type","modifier","data","node","mergeTag","find","a","mergeTagIcon","icon","renderedIcon","createElement","src","apply","insertNodes","text","at","Fragment","_extends","contentEditable","className","color","dangerouslySetInnerHTML","__html","label","onClick","setTimeout"],"sources":["@quillforms/admin-components/src/rich-text/components/merge-tag/index.tsx"],"sourcesContent":["/**\r\n * QuillForms Dependencies\r\n */\r\nimport type { IconDescriptor, Icon as IconType } from '@quillforms/types';\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useEffect } from 'react';\r\n// @ts-expect-error\r\nimport { Icon, Dashicon } from '@wordpress/components';\r\nimport { plus, close } from '@wordpress/icons';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { Editor, Path, Transforms } from 'slate';\r\nimport classnames from 'classnames';\r\nimport { css } from 'emotion';\r\nimport { ReactEditor, RenderElementProps } from 'slate-react';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport getPlainExcerpt from '../../get-plain-excerpt';\r\nimport type { MergeTags, MergeTag, CustomElement } from '../../types';\r\n\r\ninterface Props extends RenderElementProps {\r\n\tpath: Path;\r\n\tmergeTags: MergeTags;\r\n\teditor: ReactEditor;\r\n\tchildren: React.ReactNode;\r\n\telement: CustomElement;\r\n}\r\nconst EditorMergeTag: React.FC< Props > = ( {\r\n\tattributes,\r\n\teditor,\r\n\tchildren,\r\n\tpath,\r\n\telement,\r\n\tmergeTags,\r\n} ) => {\r\n\tconst { type, modifier } = element.data as MergeTag;\r\n\tconst [ node ] = Editor.node( editor, path );\r\n\r\n\tconst mergeTag = mergeTags.find(\r\n\t\t( a ) => a.type === type && a.modifier === modifier\r\n\t);\r\n\tconst mergeTagIcon = mergeTag?.icon ? mergeTag.icon : plus;\r\n\tconst renderedIcon = (\r\n\t\t<Icon\r\n\t\t\ticon={\r\n\t\t\t\t( ( mergeTagIcon as IconDescriptor )?.src as IconType )\r\n\t\t\t\t\t? ( ( mergeTagIcon as IconDescriptor )?.src as IconType )\r\n\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t: ( mergeTagIcon as Dashicon.Icon )\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! mergeTag ) {\r\n\t\t\teditor.apply( { type: 'remove_node', path, node } );\r\n\t\t\tTransforms.insertNodes(\r\n\t\t\t\teditor,\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: `{{${ type }:${ modifier }}}`,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tat: path,\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}, [] );\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ mergeTag && (\r\n\t\t\t\t<span\r\n\t\t\t\t\t{ ...attributes }\r\n\t\t\t\t\tcontentEditable={ false }\r\n\t\t\t\t\tclassName={ classnames(\r\n\t\t\t\t\t\t'rich-text-merge-tag__node-wrapper',\r\n\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\tcolor: ${ mergeTag?.color\r\n\t\t\t\t\t\t\t\t? mergeTag.color\r\n\t\t\t\t\t\t\t\t: '#bb426f' };\r\n\t\t\t\t\t\t\tbordercolor: ${ mergeTag?.color\r\n\t\t\t\t\t\t\t\t? mergeTag.color\r\n\t\t\t\t\t\t\t\t: '#bb426f' };\r\n\t\t\t\t\t\t\tfill: ${ mergeTag?.color\r\n\t\t\t\t\t\t\t\t? mergeTag.color\r\n\t\t\t\t\t\t\t\t: '#bb426f' };\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t) }\r\n\t\t\t\t>\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tclassName={ classnames(\r\n\t\t\t\t\t\t\t'rich-text-merge-tag__background',\r\n\t\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\t\tbackground: ${ mergeTag?.color\r\n\t\t\t\t\t\t\t\t\t? mergeTag.color\r\n\t\t\t\t\t\t\t\t\t: '#bb426f' };\r\n\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<span className=\"rich-text-merge-tag__icon-box\">\r\n\t\t\t\t\t\t{ renderedIcon }\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tclassName=\"rich-text-merge-tag__title\"\r\n\t\t\t\t\t\tdangerouslySetInnerHTML={ {\r\n\t\t\t\t\t\t\t__html: getPlainExcerpt( mergeTag.label ),\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclassName=\"rich-text-merge-tag__delete\"\r\n\t\t\t\t\t\tonClick={ () => {\r\n\t\t\t\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\t\t\t\teditor.apply( {\r\n\t\t\t\t\t\t\t\t\ttype: 'remove_node',\r\n\t\t\t\t\t\t\t\t\tpath,\r\n\t\t\t\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}, 0 );\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon icon={ close } />\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t{ children }\r\n\t\t\t\t</span>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n};\r\nexport default EditorMergeTag;\r\n"],"mappings":"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"}