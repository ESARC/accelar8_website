{"version":3,"names":["identAlphabetically","useSelect","forEach","size","getPlainExcerpt","useFields","_ref","section","blockTypes","formBlocks","select","getBlockTypes","getBlocks","blocks","block","index","name","supports","editable","push","order","innerBlocks","childBlock","childIndex","parseInt","fields","blockType","type","value","id","label","attributes","iconBox","icon","color","isMergeTag","other"],"sources":["@quillforms/admin-components/src/combobox-control/use-fields.ts"],"sourcesContent":["/**\r\n * Quill Forms Dependencies\r\n */\r\n\r\nimport { identAlphabetically } from '@quillforms/utils';\r\n\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect } from '@wordpress/data';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { forEach, size } from 'lodash';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport type { Options } from '.';\r\nimport { getPlainExcerpt } from '../rich-text';\r\nimport { FormBlocks } from '@quillforms/types/src';\r\n\r\nconst useFields = ( { section } ) => {\r\n\tconst { blockTypes, formBlocks } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tblockTypes: select( 'quillForms/blocks' ).getBlockTypes(),\r\n\t\t\t// @ts-expect-error\r\n\t\t\tformBlocks: select( 'quillForms/block-editor' ).getBlocks(),\r\n\t\t};\r\n\t} );\r\n\tconst blocks: FormBlocks = [];\r\n\r\n\tif ( size( formBlocks ) > 0 ) {\r\n\t\tforEach( formBlocks, ( block, index ) => {\r\n\t\t\tif ( blockTypes[ block.name ]?.supports?.editable ) {\r\n\t\t\t\tblocks.push( { ...block, order: index } );\r\n\t\t\t}\r\n\t\t\tif ( blockTypes[ block.name ]?.supports?.innerBlocks ) {\r\n\t\t\t\tif ( size( block?.innerBlocks ) > 0 ) {\r\n\t\t\t\t\tforEach( block.innerBlocks, ( childBlock, childIndex ) => {\r\n\t\t\t\t\t\tblocks.push( {\r\n\t\t\t\t\t\t\t...childBlock,\r\n\t\t\t\t\t\t\torder:\r\n\t\t\t\t\t\t\t\tindex +\r\n\t\t\t\t\t\t\t\tidentAlphabetically( parseInt( childIndex ) ),\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\tconst fields: Options = [];\r\n\tif ( size( blocks ) > 0 ) {\r\n\t\tfor ( const block of blocks ) {\r\n\t\t\tconst blockType = blockTypes[ block.name ];\r\n\t\t\tfields.push( {\r\n\t\t\t\ttype: 'field',\r\n\t\t\t\tvalue: block.id,\r\n\t\t\t\tlabel: block.attributes?.label\r\n\t\t\t\t\t? getPlainExcerpt( block.attributes.label )\r\n\t\t\t\t\t: '',\r\n\t\t\t\ticonBox: {\r\n\t\t\t\t\ticon: blockType?.icon,\r\n\t\t\t\t\tcolor: blockType?.color,\r\n\t\t\t\t},\r\n\t\t\t\tsection,\r\n\t\t\t\tisMergeTag: true,\r\n\t\t\t\tother: {\r\n\t\t\t\t\tname: block.name,\r\n\t\t\t\t},\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\treturn fields;\r\n};\r\n\r\nexport default useFields;\r\n"],"mappings":"AAAA;AACA;AACA;;AAEA,SAASA,mBAAmB,QAAQ,mBAAmB;;AAEvD;AACA;AACA;AACA,SAASC,SAAS,QAAQ,iBAAiB;;AAE3C;AACA;AACA;AACA,SAASC,OAAO,EAAEC,IAAI,QAAQ,QAAQ;;AAEtC;AACA;AACA;;AAEA,SAASC,eAAe,QAAQ,cAAc;AAG9C,MAAMC,SAAS,GAAGC,IAAA,IAAmB;EAAA,IAAjB;IAAEC;EAAQ,CAAC,GAAAD,IAAA;EAC9B,MAAM;IAAEE,UAAU;IAAEC;EAAW,CAAC,GAAGR,SAAS,CAAIS,MAAM,IAAM;IAC3D,OAAO;MACNF,UAAU,EAAEE,MAAM,CAAE,mBAAmB,CAAE,CAACC,aAAa,EAAE;MACzD;MACAF,UAAU,EAAEC,MAAM,CAAE,yBAAyB,CAAE,CAACE,SAAS;IAC1D,CAAC;EACF,CAAC,CAAE;EACH,MAAMC,MAAkB,GAAG,EAAE;EAE7B,IAAKV,IAAI,CAAEM,UAAU,CAAE,GAAG,CAAC,EAAG;IAC7BP,OAAO,CAAEO,UAAU,EAAE,CAAEK,KAAK,EAAEC,KAAK,KAAM;MACxC,IAAKP,UAAU,CAAEM,KAAK,CAACE,IAAI,CAAE,EAAEC,QAAQ,EAAEC,QAAQ,EAAG;QACnDL,MAAM,CAACM,IAAI,CAAE;UAAE,GAAGL,KAAK;UAAEM,KAAK,EAAEL;QAAM,CAAC,CAAE;MAC1C;MACA,IAAKP,UAAU,CAAEM,KAAK,CAACE,IAAI,CAAE,EAAEC,QAAQ,EAAEI,WAAW,EAAG;QACtD,IAAKlB,IAAI,CAAEW,KAAK,EAAEO,WAAW,CAAE,GAAG,CAAC,EAAG;UACrCnB,OAAO,CAAEY,KAAK,CAACO,WAAW,EAAE,CAAEC,UAAU,EAAEC,UAAU,KAAM;YACzDV,MAAM,CAACM,IAAI,CAAE;cACZ,GAAGG,UAAU;cACbF,KAAK,EACJL,KAAK,GACLf,mBAAmB,CAAEwB,QAAQ,CAAED,UAAU,CAAE;YAC7C,CAAC,CAAE;UACJ,CAAC,CAAE;QACJ;MACD;IACD,CAAC,CAAE;EACJ;EACA,MAAME,MAAe,GAAG,EAAE;EAC1B,IAAKtB,IAAI,CAAEU,MAAM,CAAE,GAAG,CAAC,EAAG;IACzB,KAAM,MAAMC,KAAK,IAAID,MAAM,EAAG;MAC7B,MAAMa,SAAS,GAAGlB,UAAU,CAAEM,KAAK,CAACE,IAAI,CAAE;MAC1CS,MAAM,CAACN,IAAI,CAAE;QACZQ,IAAI,EAAE,OAAO;QACbC,KAAK,EAAEd,KAAK,CAACe,EAAE;QACfC,KAAK,EAAEhB,KAAK,CAACiB,UAAU,EAAED,KAAK,GAC3B1B,eAAe,CAAEU,KAAK,CAACiB,UAAU,CAACD,KAAK,CAAE,GACzC,EAAE;QACLE,OAAO,EAAE;UACRC,IAAI,EAAEP,SAAS,EAAEO,IAAI;UACrBC,KAAK,EAAER,SAAS,EAAEQ;QACnB,CAAC;QACD3B,OAAO;QACP4B,UAAU,EAAE,IAAI;QAChBC,KAAK,EAAE;UACNpB,IAAI,EAAEF,KAAK,CAACE;QACb;MACD,CAAC,CAAE;IACJ;EACD;EAEA,OAAOS,MAAM;AACd,CAAC;AAED,eAAepB,SAAS"}