{"version":3,"names":["useMemo","FixedSizeList","List","cloneDeep","ChoiceContextProvider","ChoiceWrapper","ChoiceRow","__experimentalDragDropContext","__experimentalDroppable","generateChoiceId","ChoicesInserter","_ref","choices","setChoices","withAttachment","labelChangeHandler","val","index","$choices","label","addChoice","at","splice","value","deleteChoice","newChoices","filter","choice","deleteImageHandler","imageUrl","undefined","handleMediaUpload","media","url","context","createElement","onDragEnd","result","source","destination","sourceIndex","destinationIndex","output","Array","from","removed","Object","values","droppableId","mode","renderClone","provided","_snapshot","rubric","_extends","draggableProps","dragHandleProps","ref","innerRef","style","zIndex","snapshot","itemCount","isUsingPlaceholder","length","droppableProps","className","outerRef","height","width","itemSize","itemData"],"sources":["@quillforms/admin-components/src/choices-inserter/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { useMemo } from 'react';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { FixedSizeList as List } from 'react-window';\r\nimport { cloneDeep } from 'lodash';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { ChoiceContextProvider } from './choices-context';\r\nimport ChoiceWrapper from './choice-wrapper';\r\nimport ChoiceRow from './choice-row';\r\nimport __experimentalDragDropContext from '../drag-drop-context';\r\nimport __experimentalDroppable from '../droppable';\r\nimport generateChoiceId from './generate-choice-id';\r\nimport type { Choices } from '../choices-bulk-btn/types';\r\n\r\ninterface Props {\r\n\tchoices: Choices;\r\n\tsetChoices: ( choices: Choices ) => void;\r\n\twithAttachment: boolean;\r\n}\r\nconst ChoicesInserter: React.FC< Props > = ( {\r\n\tchoices,\r\n\tsetChoices,\r\n\twithAttachment,\r\n} ) => {\r\n\tconst labelChangeHandler = ( val: string, index: number ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices[ index ] = { ...$choices[ index ], label: val };\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\r\n\tconst addChoice = ( at: number ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices.splice( at, 0, {\r\n\t\t\tvalue: generateChoiceId(),\r\n\t\t\tlabel: '',\r\n\t\t} );\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\r\n\tconst deleteChoice = ( value: string ) => {\r\n\t\tconst newChoices = cloneDeep( choices ).filter(\r\n\t\t\t( choice ) => choice.value !== value\r\n\t\t);\r\n\t\tsetChoices( newChoices );\r\n\t};\r\n\r\n\tconst deleteImageHandler = ( index ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices[ index ].imageUrl = undefined;\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\tconst handleMediaUpload = ( media, index ) => {\r\n\t\tconst $choices = cloneDeep( choices );\r\n\t\t$choices[ index ].imageUrl = media.url;\r\n\t\tsetChoices( $choices );\r\n\t};\r\n\r\n\tconst context = {\r\n\t\taddChoice,\r\n\t\tlabelChangeHandler,\r\n\t\tdeleteChoice,\r\n\t\tdeleteImageHandler,\r\n\t\thandleMediaUpload,\r\n\t\twithAttachment,\r\n\t};\r\n\r\n\treturn (\r\n\t\t<__experimentalDragDropContext\r\n\t\t\tonDragEnd={ ( result ) => {\r\n\t\t\t\tconst { source, destination } = result;\r\n\t\t\t\tif (\r\n\t\t\t\t\t! result.destination ||\r\n\t\t\t\t\tresult.source.index === result.destination.index\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst sourceIndex = source.index;\r\n\t\t\t\tconst destinationIndex = destination?.index;\r\n\t\t\t\tconst $choices = [ ...choices ];\r\n\t\t\t\tconst output = Array.from( $choices );\r\n\t\t\t\tconst [ removed ] = output.splice( sourceIndex, 1 );\r\n\t\t\t\tif ( destinationIndex !== undefined ) {\r\n\t\t\t\t\toutput.splice( destinationIndex, 0, removed );\r\n\t\t\t\t\tsetChoices( output );\r\n\t\t\t\t}\r\n\t\t\t} }\r\n\t\t>\r\n\t\t\t<ChoiceContextProvider\r\n\t\t\t\t// It is important to return the same object if props haven't\r\n\t\t\t\t// changed to avoid  unnecessary rerenders.\r\n\t\t\t\t// See https://reactjs.org/docs/context.html#caveats.\r\n\t\t\t\tvalue={ useMemo( () => context, Object.values( context ) ) }\r\n\t\t\t>\r\n\t\t\t\t<__experimentalDroppable\r\n\t\t\t\t\tdroppableId=\"CHOICES_DROP_AREA\"\r\n\t\t\t\t\tmode=\"virtual\"\r\n\t\t\t\t\trenderClone={ ( provided, _snapshot, rubric ) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t{ ...provided.draggableProps }\r\n\t\t\t\t\t\t\t\t{ ...provided.dragHandleProps }\r\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\r\n\t\t\t\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\t\t\t\t...provided.draggableProps.style,\r\n\t\t\t\t\t\t\t\t\tzIndex: 111111111,\r\n\t\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<ChoiceRow\r\n\t\t\t\t\t\t\t\t\tchoices={ choices }\r\n\t\t\t\t\t\t\t\t\tindex={ rubric.source.index }\r\n\t\t\t\t\t\t\t\t\tprovided={ provided }\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ ( provided, snapshot ) => {\r\n\t\t\t\t\t\tconst itemCount = snapshot.isUsingPlaceholder\r\n\t\t\t\t\t\t\t? choices.length + 1\r\n\t\t\t\t\t\t\t: choices.length;\r\n\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\r\n\t\t\t\t\t\t\t\t{ ...provided.droppableProps }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<List\r\n\t\t\t\t\t\t\t\t\tclassName=\"admin-components-choices-inserter__choices-wrapper\"\r\n\t\t\t\t\t\t\t\t\touterRef={ provided.innerRef }\r\n\t\t\t\t\t\t\t\t\theight={ 250 }\r\n\t\t\t\t\t\t\t\t\twidth={ '100%' }\r\n\t\t\t\t\t\t\t\t\titemCount={ itemCount }\r\n\t\t\t\t\t\t\t\t\titemSize={ 54 }\r\n\t\t\t\t\t\t\t\t\titemData={ choices }\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{ ChoiceWrapper }\r\n\t\t\t\t\t\t\t\t</List>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} }\r\n\t\t\t\t</__experimentalDroppable>\r\n\t\t\t</ChoiceContextProvider>\r\n\t\t</__experimentalDragDropContext>\r\n\t);\r\n};\r\n\r\nexport default ChoicesInserter;\r\n"],"mappings":"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"}