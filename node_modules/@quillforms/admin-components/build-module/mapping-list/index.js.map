{"version":3,"names":["useState","useEffect","useMemo","MappingRow","MappingList","_ref","sections","options","initial","onChange","initialMappingRows","result","key","value","Object","entries","push","option","required","find","item","length","mappingRows","setMappingRows","selectedKeys","map","row","fields","type","createElement","fieldRow","index","keyProps","filter","includes","state","newState","disabled","valueProps","customize","combobox","onAddClick","splice","onRemoveClick","undefined"],"sources":["@quillforms/admin-components/src/mapping-list/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { Option, Sections } from '../mapping-row/key-control';\r\nimport { CustomizeFunction } from '../combobox-control';\r\nimport { useState, useEffect, useMemo } from 'react';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport MappingRow from '../mapping-row';\r\n\r\ntype Options = ( Option & {\r\n\trequired?: boolean; // makes the option disabled and added by default.\r\n\tcombobox?: {\r\n\t\tcustomize?: CustomizeFunction;\r\n\t};\r\n} )[];\r\n\r\ntype MappingRowValue = {\r\n\tkey: string;\r\n\tvalue: {\r\n\t\ttype?: string;\r\n\t\tvalue?: string;\r\n\t};\r\n};\r\n\r\ntype Fields = {\r\n\t[ key: string ]: { type: string; value: string };\r\n};\r\n\r\ninterface Props {\r\n\tsections?: Sections; // key sections.\r\n\toptions?: Options; // key options.\r\n\tinitial?: Fields; // used for setup initial mapping rows state.\r\n\tonChange: ( fields: Fields ) => void; // fields contain only the data of valid rows.\r\n}\r\n\r\nconst MappingList: React.FC< Props > = ( {\r\n\tsections,\r\n\toptions,\r\n\tinitial,\r\n\tonChange,\r\n} ) => {\r\n\t// initial mapping rows.\r\n\tconst initialMappingRows: MappingRowValue[] = useMemo( () => {\r\n\t\tconst result: MappingRowValue[] = [];\r\n\t\t// first add the initial fields.\r\n\t\tfor ( const [ key, value ] of Object.entries( initial ?? {} ) ) {\r\n\t\t\tresult.push( {\r\n\t\t\t\tkey,\r\n\t\t\t\tvalue,\r\n\t\t\t} );\r\n\t\t}\r\n\t\t// then add the required options.\r\n\t\tfor ( const option of options ?? [] ) {\r\n\t\t\tif (\r\n\t\t\t\toption.required &&\r\n\t\t\t\t! result.find( ( item ) => item.key === option.value )\r\n\t\t\t) {\r\n\t\t\t\tresult.push( {\r\n\t\t\t\t\tkey: option.value,\r\n\t\t\t\t\tvalue: {},\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t\t// add an empty option if there is no options added.\r\n\t\tif ( result.length === 0 ) {\r\n\t\t\tresult.push( {\r\n\t\t\t\tkey: '',\r\n\t\t\t\tvalue: {},\r\n\t\t\t} );\r\n\t\t}\r\n\t\treturn result;\r\n\t}, [] );\r\n\r\n\t// mapping rows state.\r\n\tconst [ mappingRows, setMappingRows ] =\r\n\t\tuseState< MappingRowValue[] >( initialMappingRows );\r\n\tconst selectedKeys = mappingRows.map( ( row ) => row.key );\r\n\r\n\t// call onChange\r\n\tuseEffect( () => {\r\n\t\tconst fields = {};\r\n\t\tfor ( const { key, value } of mappingRows ) {\r\n\t\t\tif ( key && value.type && value.value ) {\r\n\t\t\t\tfields[ key ] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t\tonChange( fields );\r\n\t}, [ mappingRows ] );\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t{ mappingRows.map( ( fieldRow, index ) => {\r\n\t\t\t\tconst option = options?.find(\r\n\t\t\t\t\t( option ) => option.value === fieldRow.key\r\n\t\t\t\t);\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<MappingRow\r\n\t\t\t\t\t\tkey={ index }\r\n\t\t\t\t\t\tkeyProps={ {\r\n\t\t\t\t\t\t\tsections: sections,\r\n\t\t\t\t\t\t\toptions: options?.filter(\r\n\t\t\t\t\t\t\t\t( option ) =>\r\n\t\t\t\t\t\t\t\t\toption.value === fieldRow.key ||\r\n\t\t\t\t\t\t\t\t\t! selectedKeys.includes( option.value )\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\tvalue: fieldRow.key,\r\n\t\t\t\t\t\t\tonChange: ( key ) => {\r\n\t\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\t\tnewState[ index ] = {\r\n\t\t\t\t\t\t\t\t\t\tkey,\r\n\t\t\t\t\t\t\t\t\t\tvalue: {},\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tdisabled: option?.required,\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tvalueProps={ {\r\n\t\t\t\t\t\t\tvalue: fieldRow.value,\r\n\t\t\t\t\t\t\tonChange: ( value ) => {\r\n\t\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\t\tnewState[ index ].value = value;\r\n\t\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcustomize: option?.combobox?.customize,\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tonAddClick={ () => {\r\n\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\tnewState.splice( index + 1, 0, {\r\n\t\t\t\t\t\t\t\t\tkey: '',\r\n\t\t\t\t\t\t\t\t\tvalue: {},\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tonRemoveClick={\r\n\t\t\t\t\t\t\toption?.required || mappingRows.length === 1\r\n\t\t\t\t\t\t\t\t? undefined\r\n\t\t\t\t\t\t\t\t: () => {\r\n\t\t\t\t\t\t\t\t\t\tsetMappingRows( ( state ) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconst newState = [ ...state ];\r\n\t\t\t\t\t\t\t\t\t\t\tnewState.splice( index, 1 );\r\n\t\t\t\t\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t} ) }\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default MappingList;\r\n"],"mappings":"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"}