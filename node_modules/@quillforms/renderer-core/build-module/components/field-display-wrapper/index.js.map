{"version":3,"names":["useSelect","useDispatch","useEffect","useState","useRef","doAction","css","__experimentalUseFieldRenderContext","useBlockTypes","BlockFooter","useFormContext","useHandleFocus","useBlockTheme","timer1","timer2","FieldDisplayWrapper","_ref","isShaking","setIsShaking","inputRef","id","next","blockName","isActive","attributes","showNextBtn","showErrMsg","innerBlocks","theme","themeId","isTouchScreen","window","navigator","maxTouchPoints","msMaxTouchPoints","isPreview","formId","blockTypes","blockType","shakingErr","setShakingErr","isCurrentBlockEditable","isReviewing","select","hasBlockSupport","answerValue","isAnswered","isValid","isPending","getFieldAnswerVal","isAnsweredField","isValidField","isFieldPending","clearTimers","clearTimeout","setFooterDisplay","shakeWithError","err","setTimeout","action","label","setIsFieldValid","setFieldValidationErr","setIsFieldAnswered","setIsFieldPending","setFieldPendingMsg","setFieldAnswer","props","val","setIsValid","setIsAnswered","setIsPending","setPendingMsg","setValidationErr","setVal","blockWithError","createElement","role","className","display","typographyPreset"],"sources":["@quillforms/renderer-core/src/components/field-display-wrapper/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useState, useRef } from '@wordpress/element';\r\nimport { doAction } from '@wordpress/hooks';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { css } from 'emotion';\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { __experimentalUseFieldRenderContext } from '../field-render';\r\nimport useBlockTypes from '../../hooks/use-block-types';\r\nimport BlockFooter from '../field-footer';\r\nimport useFormContext from '../../hooks/use-form-context';\r\nimport useHandleFocus from '../../hooks/use-handle-focus';\r\nimport useBlockTheme from '../../hooks/use-block-theme';\r\ninterface Props {\r\n\tsetIsShaking: ( value: boolean ) => void;\r\n\tisShaking: boolean;\r\n}\r\nlet timer1: ReturnType< typeof setTimeout >,\r\n\ttimer2: ReturnType< typeof setTimeout >;\r\n\r\nconst FieldDisplayWrapper: React.FC< Props > = ( {\r\n\tisShaking,\r\n\tsetIsShaking,\r\n} ) => {\r\n\tconst inputRef = useRef( null );\r\n\tconst {\r\n\t\tid,\r\n\t\tnext,\r\n\t\tblockName,\r\n\t\tisActive,\r\n\t\tattributes,\r\n\t\tshowNextBtn,\r\n\t\tshowErrMsg,\r\n\t\tinnerBlocks,\r\n\t} = __experimentalUseFieldRenderContext();\r\n\tconst theme = useBlockTheme( attributes?.themeId );\r\n\r\n\tconst isTouchScreen =\r\n\t\t( typeof window !== 'undefined' && 'ontouchstart' in window ) ||\r\n\t\t( typeof navigator !== 'undefined' && navigator.maxTouchPoints > 0 ) ||\r\n\t\t// @ts-expect-error\r\n\t\t( typeof navigator !== 'undefined' && navigator.msMaxTouchPoints > 0 );\r\n\r\n\tuseHandleFocus( inputRef, isActive, isTouchScreen );\r\n\tconst { isPreview, formId } = useFormContext();\r\n\r\n\tif ( ! blockName || ! id ) return null;\r\n\tconst blockTypes = useBlockTypes();\r\n\tconst blockType = blockTypes[ blockName ];\r\n\tconst [ shakingErr, setShakingErr ] = useState( null );\r\n\r\n\tconst { isCurrentBlockEditable, isReviewing } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tisCurrentBlockEditable: select(\r\n\t\t\t\t'quillForms/blocks'\r\n\t\t\t).hasBlockSupport( blockName, 'editable' ),\r\n\t\t\tisReviewing: select( 'quillForms/renderer-core' ).isReviewing(),\r\n\t\t};\r\n\t} );\r\n\tconst { answerValue, isAnswered, isValid, isPending } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\treturn {\r\n\t\t\t\tanswerValue: isCurrentBlockEditable\r\n\t\t\t\t\t? select( 'quillForms/renderer-core' ).getFieldAnswerVal(\r\n\t\t\t\t\t\t\tid\r\n\t\t\t\t\t  )\r\n\t\t\t\t\t: null,\r\n\t\t\t\tisAnswered: isCurrentBlockEditable\r\n\t\t\t\t\t? select( 'quillForms/renderer-core' ).isAnsweredField( id )\r\n\t\t\t\t\t: null,\r\n\t\t\t\tisValid: isCurrentBlockEditable\r\n\t\t\t\t\t? select( 'quillForms/renderer-core' ).isValidField( id )\r\n\t\t\t\t\t: null,\r\n\t\t\t\tisPending: select( 'quillForms/renderer-core' ).isFieldPending(\r\n\t\t\t\t\tid\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t}\r\n\t);\r\n\r\n\tconst clearTimers = () => {\r\n\t\tclearTimeout( timer1 );\r\n\t\tclearTimeout( timer2 );\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tclearTimers();\r\n\t\tsetIsShaking( false );\r\n\t\tif ( shakingErr ) setShakingErr( null );\r\n\t}, [ answerValue ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! isActive ) {\r\n\t\t\tclearTimers();\r\n\t\t\tsetIsShaking( false );\r\n\t\t\tif ( shakingErr ) setShakingErr( null );\r\n\t\t}\r\n\r\n\t\tif ( isActive ) {\r\n\t\t\tsetFooterDisplay( true );\r\n\t\t}\r\n\t}, [ isActive ] );\r\n\r\n\tconst shakeWithError = ( err ) => {\r\n\t\tclearTimers();\r\n\t\tif ( ! isShaking ) setIsShaking( true );\r\n\t\tif ( ! shakingErr ) setShakingErr( err );\r\n\t\ttimer1 = setTimeout( () => {\r\n\t\t\tsetIsShaking( false );\r\n\t\t}, 600 );\r\n\t\ttimer2 = setTimeout( () => {\r\n\t\t\tsetShakingErr( null );\r\n\t\t}, 1200 );\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isAnswered ) {\r\n\t\t\tconst action = isActive\r\n\t\t\t\t? 'QuillForms.RendererCore.FieldAnsweredActive'\r\n\t\t\t\t: 'QuillForms.RendererCore.FieldAnswered';\r\n\t\t\tdoAction( action, {\r\n\t\t\t\tformId,\r\n\t\t\t\tid,\r\n\t\t\t\tlabel: attributes?.label,\r\n\t\t\t} );\r\n\t\t}\r\n\t}, [ isAnswered, isActive ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isActive ) {\r\n\t\t\tdoAction( 'QuillForms.RendererCore.FieldActive', {\r\n\t\t\t\tformId,\r\n\t\t\t\tid,\r\n\t\t\t\tlabel: attributes?.label,\r\n\t\t\t} );\r\n\t\t}\r\n\t}, [ isActive ] );\r\n\r\n\tconst {\r\n\t\tsetIsFieldValid,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetIsFieldAnswered,\r\n\t\tsetIsFieldPending,\r\n\t\tsetFieldPendingMsg,\r\n\t\tsetFieldAnswer,\r\n\t\tsetFooterDisplay,\r\n\t} = useDispatch( 'quillForms/renderer-core' );\r\n\r\n\tconst props = {\r\n\t\tid,\r\n\t\tnext,\r\n\t\tattributes,\r\n\t\tisValid,\r\n\t\tisPending,\r\n\t\tinnerBlocks,\r\n\t\tisReviewing,\r\n\t\tval: answerValue,\r\n\t\tsetIsValid: ( val: boolean ) => setIsFieldValid( id, val ),\r\n\t\tsetIsAnswered: ( val: boolean ) => setIsFieldAnswered( id, val ),\r\n\t\tsetIsPending: ( val: boolean ) => setIsFieldPending( id, val ),\r\n\t\tsetPendingMsg: ( val: string ) => setFieldPendingMsg( id, val ),\r\n\t\tsetValidationErr: ( val: string ) => setFieldValidationErr( id, val ),\r\n\t\tsetVal: ( val: string ) => setFieldAnswer( id, val ),\r\n\t\tshowNextBtn,\r\n\t\tblockWithError: ( err: string ) => shakeWithError( err ),\r\n\t\tshowErrMsg,\r\n\t\tisPreview,\r\n\t\tisTouchScreen,\r\n\t\tinputRef,\r\n\t\tsetFooterDisplay,\r\n\t\tformId,\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\trole=\"presentation\"\r\n\t\t\tclassName=\"renderer-core-field-display-wrapper\"\r\n\t\t>\r\n\t\t\t{ blockType?.display && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={ css`\r\n\t\t\t\t\t\t@media ( max-width: 767px ) {\r\n\t\t\t\t\t\t\tmargin-top: ${ theme.typographyPreset === 'sm'\r\n\t\t\t\t\t\t\t\t? `24px`\r\n\t\t\t\t\t\t\t\t: `32px` };\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t@media ( min-width: 768px ) {\r\n\t\t\t\t\t\t\tmargin-top: ${ theme.typographyPreset === 'sm'\r\n\t\t\t\t\t\t\t\t? `24px`\r\n\t\t\t\t\t\t\t\t: theme.typographyPreset === 'lg'\r\n\t\t\t\t\t\t\t\t? `40px`\r\n\t\t\t\t\t\t\t\t: `32px` };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t` }\r\n\t\t\t\t>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t/* @ts-expect-error */\r\n\t\t\t\t\t\t<blockType.display { ...props } />\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t\t<BlockFooter shakingErr={ shakingErr } isPending={ isPending } />\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default FieldDisplayWrapper;\r\n"],"mappings":"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"}