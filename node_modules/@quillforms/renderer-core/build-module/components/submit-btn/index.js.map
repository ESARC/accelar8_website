{"version":3,"names":["useSelect","useDispatch","useEffect","useState","classNames","TailSpin","Loader","css","Button","HTMLParser","useBlockTheme","useFormContext","useMessages","__experimentalUseFieldRenderContext","SubmitBtn","messages","isLastField","isActive","attributes","theme","themeId","goToBlock","goNext","setIsReviewing","setIsSubmitting","setIsFieldValid","setFieldValidationErr","setSubmissionErr","completeForm","setIsCurrentBlockSafeToSwipe","setIsFieldPending","onSubmit","beforeGoingNext","isWaitingPending","setIsWaitingPending","answers","firstInvalidFieldId","pendingMsg","isSubmitting","submissionErr","currentBlockId","select","getCurrentBlockId","getAnswers","getPendingMsg","getFirstInvalidFieldId","getSubmissionErr","handleKeyDown","e","key","metaKey","submitHandler","goToFirstInvalidField","window","addEventListener","removeEventListener","setIsPending","val","reviewAndSubmit","setTimeout","createElement","className","onClick","onKeyDown","stopPropagation","value","wrapperClass","color","height","width","questionsColor"],"sources":["@quillforms/renderer-core/src/components/submit-btn/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useState } from '@wordpress/element';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport classNames from 'classnames';\r\nimport { TailSpin as Loader } from 'react-loader-spinner';\r\nimport { css } from 'emotion';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport Button from '../button';\r\nimport HTMLParser from '../html-parser';\r\nimport { useBlockTheme, useFormContext, useMessages } from '../../hooks';\r\nimport { __experimentalUseFieldRenderContext } from '../field-render';\r\n\r\nconst SubmitBtn: React.FC = () => {\r\n\tconst messages = useMessages();\r\n\tconst { isLastField, isActive, attributes } =\r\n\t\t__experimentalUseFieldRenderContext();\r\n\tconst theme = useBlockTheme( attributes?.themeId );\r\n\r\n\tconst {\r\n\t\tgoToBlock,\r\n\t\tgoNext,\r\n\t\tsetIsReviewing,\r\n\t\tsetIsSubmitting,\r\n\t\tsetIsFieldValid,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetSubmissionErr,\r\n\t\tcompleteForm,\r\n\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\tsetIsFieldPending,\r\n\t} = useDispatch( 'quillForms/renderer-core' );\r\n\tconst { onSubmit, beforeGoingNext } = useFormContext();\r\n\tconst [ isWaitingPending, setIsWaitingPending ] = useState( false );\r\n\r\n\tconst {\r\n\t\tanswers,\r\n\t\tfirstInvalidFieldId,\r\n\t\tpendingMsg,\r\n\t\tisSubmitting,\r\n\t\tsubmissionErr,\r\n\t\tcurrentBlockId,\r\n\t} = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tcurrentBlockId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getCurrentBlockId(),\r\n\t\t\tanswers: select( 'quillForms/renderer-core' ).getAnswers(),\r\n\t\t\tpendingMsg: select( 'quillForms/renderer-core' ).getPendingMsg(),\r\n\t\t\tisSubmitting: select( 'quillForms/renderer-core' ).isSubmitting(),\r\n\t\t\tfirstInvalidFieldId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getFirstInvalidFieldId(),\r\n\t\t\tsubmissionErr: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getSubmissionErr(),\r\n\t\t};\r\n\t} );\r\n\r\n\r\n\tif ( ! currentBlockId ) return null;\r\n\r\n\tconst handleKeyDown = ( e ) => {\r\n\t\tif ( e.key === 'Enter' ) {\r\n\t\t\tif ( e.metaKey ) {\r\n\t\t\t\tsubmitHandler();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst goToFirstInvalidField = () => {\r\n\t\tif ( firstInvalidFieldId ) goToBlock( firstInvalidFieldId );\r\n\t};\r\n\tuseEffect( () => {\r\n\t\tif ( isLastField && isActive ) {\r\n\t\t\tsetIsReviewing( false );\r\n\t\t\twindow.addEventListener( 'keydown', handleKeyDown );\r\n\t\t} else {\r\n\t\t\tremoveEventListener( 'keydown', handleKeyDown );\r\n\t\t}\r\n\r\n\t\treturn () => removeEventListener( 'keydown', handleKeyDown );\r\n\t}, [ isLastField, isActive ] );\r\n\r\n\tconst submitHandler = async () => {\r\n\t\tif ( beforeGoingNext && currentBlockId ) {\r\n\t\t\tawait beforeGoingNext( {\r\n\t\t\t\tanswers,\r\n\t\t\t\tsetIsFieldValid,\r\n\t\t\t\tsetFieldValidationErr,\r\n\t\t\t\tgoToBlock,\r\n\t\t\t\tcurrentBlockId,\r\n\t\t\t\tgoNext,\r\n\t\t\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\t\t\tsetIsPending: ( val ) =>\r\n\t\t\t\t\tsetIsFieldPending( currentBlockId, val ),\r\n\t\t\t} );\r\n\t\t}\r\n\t\tif ( pendingMsg === false ) {\r\n\t\t\treviewAndSubmit();\r\n\t\t} else {\r\n\t\t\tsetIsWaitingPending( true );\r\n\t\t}\r\n\t};\r\n\r\n\tconst reviewAndSubmit = () => {\r\n\t\tsetIsReviewing( false );\r\n\t\tif ( firstInvalidFieldId ) {\r\n\t\t\tsetTimeout( () => {\r\n\t\t\t\tsetIsReviewing( true );\r\n\t\t\t}, 50 );\r\n\r\n\t\t\tsetTimeout( () => {\r\n\t\t\t\tgoToFirstInvalidField();\r\n\t\t\t}, 100 );\r\n\t\t} else {\r\n\t\t\tsetIsSubmitting( true );\r\n\t\t\tonSubmit(\r\n\t\t\t\t{ answers },\r\n\t\t\t\t{\r\n\t\t\t\t\tsetIsSubmitting,\r\n\t\t\t\t\tsetIsFieldValid,\r\n\t\t\t\t\tsetFieldValidationErr,\r\n\t\t\t\t\tsetIsReviewing,\r\n\t\t\t\t\tgoToBlock,\r\n\t\t\t\t\tcompleteForm,\r\n\t\t\t\t\tsetSubmissionErr,\r\n\t\t\t\t\tsetIsPending: ( val ) =>\r\n\t\t\t\t\t\tsetIsFieldPending( currentBlockId, val ),\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isWaitingPending && pendingMsg === false ) {\r\n\t\t\tsetIsWaitingPending( false );\r\n\t\t\treviewAndSubmit();\r\n\t\t}\r\n\t}, [ isWaitingPending, pendingMsg ] );\r\n\r\n\treturn (\r\n\t\t<div className=\"renderer-core-submit-btn-wrapper\">\r\n\t\t\t<Button\r\n\t\t\t\tclassName=\"renderer-core-submit-btn\"\r\n\t\t\t\tonClick={ () => {\r\n\t\t\t\t\tif ( ! isSubmitting ) submitHandler();\r\n\t\t\t\t} }\r\n\t\t\t\tonKeyDown={ ( e ) => {\r\n\t\t\t\t\tif ( e.key === 'Enter' ) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tif ( ! isSubmitting ) submitHandler();\r\n\t\t\t\t\t}\r\n\t\t\t\t} }\r\n\t\t\t\ttheme={ theme }\r\n\t\t\t>\r\n\t\t\t\t<HTMLParser\r\n\t\t\t\t\tvalue={\r\n\t\t\t\t\t\tisWaitingPending\r\n\t\t\t\t\t\t\t? pendingMsg\r\n\t\t\t\t\t\t\t\t? pendingMsg\r\n\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t\t: messages[ 'label.submitBtn' ]\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t\t{ ( isWaitingPending || isSubmitting ) && (\r\n\t\t\t\t\t<Loader\r\n\t\t\t\t\t\twrapperClass=\"renderer-core-submit-btn__loader\"\r\n\t\t\t\t\t\tcolor=\"#fff\"\r\n\t\t\t\t\t\theight={ 20 }\r\n\t\t\t\t\t\twidth={ 20 }\r\n\t\t\t\t\t/>\r\n\t\t\t\t) }\r\n\t\t\t</Button>\r\n\t\t\t{ submissionErr && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={ classNames(\r\n\t\t\t\t\t\t'renderer-core-submit-error',\r\n\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\tcolor: ${ theme.questionsColor };\r\n\t\t\t\t\t\t\tmargin-top: 15px;\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t) }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ submissionErr }\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default SubmitBtn;\r\n"],"mappings":"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"}