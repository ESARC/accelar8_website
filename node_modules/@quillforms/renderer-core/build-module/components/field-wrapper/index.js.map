{"version":3,"names":["useBlockTheme","useRef","useEffect","useSelect","useDispatch","classnames","css","__experimentalUseFieldRenderContext","FieldContent","filter","findIndex","useFormSettings","BlockAttachment","useFormContext","scrollTimer","tabTimer","FieldWrapper","_attributes$layout","_attributes$classname","id","isActive","shouldBeRendered","showErrMsg","next","attributes","blockName","deviceWidth","settings","blockType","select","getBlockType","swiper","isValid","isFocused","getSwiperState","supports","innerBlocks","hasValidFields","editable","isValidField","setSwiper","goPrev","setIsCurrentBlockSafeToSwipe","walkPath","currentBlockId","isAnimating","isReviewing","setCanSwipeNext","val","canSwipeNext","setCanSwipePrev","canSwipePrev","fieldIndex","field","currentFieldIndex","$field","position","ref","setTimeout","current","scrollTo","clearTimeout","focusableElementsString","getFocusables","el","Array","prototype","slice","call","document","querySelector","querySelectorAll","item","getAttribute","offsetParent","window","getComputedStyle","visibility","processTab","isShiftPressed","activeElement","focusableElements","activeElementIndex","length","contains","focus","body","onTab","e","preventDefault","scrollHandler","disableWheelSwiping","animationDirection","scrollTop","Math","abs","scrollHeight","clientHeight","layout","displayLayout","theme","themeId","backgroundImageCSS","backgroundImage","parseFloat","backgroundImageFocalPoint","x","y","specialProps","createElement","className","active","typographyPreset","font","fontSize","lg","fontLineHeight","sm","textInputAnswers","backgroundColor","attachment","tabIndex","onKeyDown","shiftKey","key","stopPropagation","_extends","onScroll","attachmentFocalPoint"],"sources":["@quillforms/renderer-core/src/components/field-wrapper/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * QuillForms Dependencies\r\n */\r\nimport useBlockTheme from '../../hooks/use-block-theme';\r\n\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useRef, useEffect } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport classnames from 'classnames';\r\nimport { css } from 'emotion';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { __experimentalUseFieldRenderContext } from '../field-render/context';\r\nimport FieldContent from '../field-content';\r\nimport { filter, findIndex } from 'lodash';\r\nimport useFormSettings from '../../hooks/use-form-settings';\r\nimport BlockAttachment from '../field-attachment';\r\nimport { useFormContext } from '../../hooks';\r\n\r\nlet scrollTimer: ReturnType< typeof setTimeout >;\r\nlet tabTimer: ReturnType< typeof setTimeout >;\r\n\r\nconst FieldWrapper: React.FC = () => {\r\n\tconst {\r\n\t\tid,\r\n\t\tisActive,\r\n\t\tshouldBeRendered,\r\n\t\tshowErrMsg,\r\n\t\tnext,\r\n\t\tattributes,\r\n\t\tblockName,\r\n\t} = __experimentalUseFieldRenderContext();\r\n\tconst { deviceWidth } = useFormContext();\r\n\r\n\tconst settings = useFormSettings();\r\n\tif ( ! id || ! blockName ) return null;\r\n\tconst { blockType } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tblockType: select( 'quillForms/blocks' ).getBlockType( blockName ),\r\n\t\t};\r\n\t} );\r\n\r\n\tif ( ! blockType ) return null;\r\n\tconst { swiper, isValid, isFocused } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tswiper: select( 'quillForms/renderer-core' ).getSwiperState(),\r\n\t\t\tisValid: blockType?.supports?.innerBlocks\r\n\t\t\t\t? select( 'quillForms/renderer-core' ).hasValidFields( id )\r\n\t\t\t\t: blockType?.supports?.editable\r\n\t\t\t\t? select( 'quillForms/renderer-core' ).isValidField( id )\r\n\t\t\t\t: true,\r\n\t\t\tisFocused: select( 'quillForms/renderer-core' ).isFocused(),\r\n\t\t};\r\n\t} );\r\n\r\n\tconst { setSwiper, goPrev, setIsCurrentBlockSafeToSwipe } = useDispatch(\r\n\t\t'quillForms/renderer-core'\r\n\t);\r\n\r\n\tconst { walkPath, currentBlockId, isAnimating, isReviewing } = swiper;\r\n\tconst setCanSwipeNext = ( val: boolean ) => {\r\n\t\t// if ( walkPath[ walkPath.length - 1 ].id === id ) val = false;\r\n\t\tsetSwiper( {\r\n\t\t\tcanSwipeNext: val,\r\n\t\t} );\r\n\t};\r\n\tconst setCanSwipePrev = ( val: boolean ) => {\r\n\t\tsetSwiper( {\r\n\t\t\tcanSwipePrev: val,\r\n\t\t} );\r\n\t};\r\n\r\n\tconst fieldIndex = walkPath.findIndex( ( field ) => field.id === id );\r\n\r\n\tconst currentFieldIndex = walkPath.findIndex(\r\n\t\t( $field ) => $field.id === currentBlockId\r\n\t);\r\n\r\n\tconst position = isActive\r\n\t\t? null\r\n\t\t: currentFieldIndex > fieldIndex\r\n\t\t? 'is-up'\r\n\t\t: 'is-down';\r\n\r\n\tconst ref = useRef< HTMLDivElement | null >( null );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isActive && ! isReviewing ) {\r\n\t\t\tsetTimeout( () => {\r\n\t\t\t\tsetIsCurrentBlockSafeToSwipe( true );\r\n\t\t\t}, 40 );\r\n\t\t}\r\n\t}, [ isActive, isReviewing ] );\r\n\tuseEffect( () => {\r\n\t\tif ( isActive ) {\r\n\t\t\tif ( ref?.current ) {\r\n\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\tif ( ref?.current ) {\r\n\t\t\t\t\t\tref.current.scrollTo( 0, 0 );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetCanSwipePrev( true );\r\n\t\t\t\t}, 0 );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tclearTimeout( tabTimer );\r\n\t\t\tclearTimeout( scrollTimer );\r\n\t\t\tsetCanSwipeNext( true );\r\n\t\t\tsetCanSwipePrev( true );\r\n\t\t}\r\n\t}, [ isActive ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isAnimating ) clearTimeout( tabTimer );\r\n\t}, [ isAnimating ] );\r\n\r\n\tconst focusableElementsString =\r\n\t\t'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex=\"0\"], [contenteditable]';\r\n\r\n\t/**\r\n\t * Gets all the focusable elements inside the passed element.\r\n\t *\r\n\t * @param  el\r\n\t */\r\n\tfunction getFocusables( el ) {\r\n\t\treturn filter(\r\n\t\t\tArray.prototype.slice.call(\r\n\t\t\t\tdocument\r\n\t\t\t\t\t.querySelector( el )\r\n\t\t\t\t\t.querySelectorAll( focusableElementsString )\r\n\t\t\t),\r\n\t\t\t( item ) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\titem.getAttribute( 'tabindex' ) !== '-1' &&\r\n\t\t\t\t\t//are also not hidden elements (or with hidden parents)\r\n\t\t\t\t\titem.offsetParent !== null &&\r\n\t\t\t\t\twindow.getComputedStyle( item ).visibility !== 'hidden'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tfunction processTab( isShiftPressed ) {\r\n\t\tif ( isAnimating ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst activeElement = document.activeElement;\r\n\t\tconst focusableElements = getFocusables( `#block-${ id }` );\r\n\t\t//outside the block? Let's not hijack the tab!\r\n\t\tif ( ! isFocused ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst activeElementIndex = findIndex(\r\n\t\t\tfocusableElements,\r\n\t\t\t( el ) => el === activeElement\r\n\t\t);\r\n\r\n\t\t// Happens when the active element is in the next block or previous block\r\n\t\t// This case occurs when pressing tab multiple times at the same time.\r\n\t\tif ( activeElementIndex === -1 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif ( ! isShiftPressed ) {\r\n\t\t\tif (\r\n\t\t\t\tactiveElement ==\r\n\t\t\t\tfocusableElements[ focusableElements.length - 1 ]\r\n\t\t\t) {\r\n\t\t\t\tnext();\r\n\t\t\t} else if (\r\n\t\t\t\tfocusableElements[ activeElementIndex + 1 ].offsetParent !==\r\n\t\t\t\t\tnull &&\r\n\t\t\t\t// If document element is still in dom\r\n\t\t\t\t// One example for this case is  the next button in each block if the block isn't valid and the error message\r\n\t\t\t\t// appear instead of the button. The button is focusable but it is no longer in dom.\r\n\t\t\t\tdocument.contains( focusableElements[ activeElementIndex + 1 ] )\r\n\t\t\t) {\r\n\t\t\t\tfocusableElements[ activeElementIndex + 1 ].focus();\r\n\t\t\t} else {\r\n\t\t\t\t//when reached the last focusable element of the block, go next\r\n\t\t\t\tnext();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//when reached the first  focusable element of the block, go prev if shift is pressed\r\n\t\t\tif ( activeElementIndex === 0 ) {\r\n\t\t\t\tgoPrev();\r\n\t\t\t} else if ( activeElementIndex === -1 ) {\r\n\t\t\t\tdocument.body.focus();\r\n\t\t\t} else {\r\n\t\t\t\tfocusableElements[ activeElementIndex - 1 ].focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Makes sure the tab key will only focus elements within the current block  preventing this way from breaking the page.\r\n\t * Otherwise, go next or prev.\r\n\t *\r\n\t * @param  e\r\n\t * @param  isShiftPressed\r\n\t */\r\n\tfunction onTab( e, isShiftPressed ) {\r\n\t\tclearTimeout( tabTimer );\r\n\t\tif ( isAnimating ) return;\r\n\t\te.preventDefault();\r\n\t\ttabTimer = setTimeout( () => {\r\n\t\t\tprocessTab( isShiftPressed );\r\n\t\t}, 150 );\r\n\t}\r\n\r\n\tconst scrollHandler = ( e ) => {\r\n\t\tif (\r\n\t\t\tsettings?.disableWheelSwiping ||\r\n\t\t\tsettings?.animationDirection === 'horizontal'\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t\tif ( ! ref.current ) return;\r\n\t\tif ( ref.current.scrollTop <= 0 ) {\r\n\t\t\tscrollTimer = setTimeout( () => {\r\n\t\t\t\tsetCanSwipePrev( true );\r\n\t\t\t}, 500 );\r\n\t\t} else {\r\n\t\t\tsetCanSwipePrev( false );\r\n\t\t}\r\n\t\t// Adding tolerance to detect scroll end.\r\n\t\t// It was a problem with mobile devices.\r\n\t\tif (\r\n\t\t\tMath.abs(\r\n\t\t\t\tref.current.scrollHeight -\r\n\t\t\t\t\tref.current.clientHeight -\r\n\t\t\t\t\tref.current.scrollTop\r\n\t\t\t) <= 3.0\r\n\t\t) {\r\n\t\t\tscrollTimer = setTimeout( () => {\r\n\t\t\t\tsetCanSwipeNext( true );\r\n\t\t\t}, 500 );\r\n\t\t} else {\r\n\t\t\tsetCanSwipeNext( false );\r\n\t\t}\r\n\t};\r\n\tconst layout =\r\n\t\tblockType?.displayLayout && blockType?.displayLayout !== 'default'\r\n\t\t\t? blockType.displayLayout\r\n\t\t\t: attributes?.layout ?? 'stack';\r\n\tconst theme = useBlockTheme( attributes?.themeId );\r\n\tlet backgroundImageCSS = '';\r\n\tif ( theme.backgroundImage && theme.backgroundImage ) {\r\n\t\tbackgroundImageCSS = `background-image: url('${\r\n\t\t\ttheme.backgroundImage\r\n\t\t}');\r\n\t\t\tbackground-size: cover;\r\n\t\t\tbackground-position: ${\r\n\t\t\t\t// @ts-expect-error\r\n\t\t\t\tparseFloat( theme.backgroundImageFocalPoint?.x ) * 100\r\n\t\t\t}%\r\n\t\t\t${\r\n\t\t\t\t// @ts-expect-error\r\n\t\t\t\tparseFloat( theme.backgroundImageFocalPoint?.y ) * 100\r\n\t\t\t}%;\r\n\t\t`;\r\n\t}\r\n\r\n\tlet specialProps = {};\r\n\tif ( isActive ) {\r\n\t\tspecialProps = {\r\n\t\t\t'data-iframe-height': true,\r\n\t\t};\r\n\t}\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={ classnames(\r\n\t\t\t\t'renderer-components-field-wrapper',\r\n\t\t\t\t{\r\n\t\t\t\t\tactive: isActive,\r\n\t\t\t\t\t'is-animating': isAnimating,\r\n\t\t\t\t\t'is-horizontal-animation':\r\n\t\t\t\t\t\tsettings?.animationDirection === 'horizontal',\r\n\t\t\t\t},\r\n\t\t\t\t`${ attributes?.classnames ?? '' }`,\r\n\t\t\t\t`${ theme.typographyPreset }-typography-preset`,\r\n\t\t\t\tposition ? position : '',\r\n\t\t\t\tcss`\r\n\t\t\t\t\tfont-family: ${ theme.font };\r\n\t\t\t\t\t@media ( min-width: 768px ) {\r\n\t\t\t\t\t\tfont-size: ${ theme.fontSize.lg };\r\n\t\t\t\t\t\tline-height: ${ theme.fontLineHeight.lg };\r\n\t\t\t\t\t}\r\n\t\t\t\t\t@media ( max-width: 767px ) {\r\n\t\t\t\t\t\tfont-size: ${ theme.fontSize.sm };\r\n\t\t\t\t\t\tline-height: ${ theme.fontLineHeight.sm };\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttextarea,\r\n\t\t\t\t\tinput {\r\n\t\t\t\t\t\tfont-family: ${ theme.font };\r\n\t\t\t\t\t\tbackground: transparent;\r\n\t\t\t\t\t\tbackground-color: transparent;\r\n\r\n\t\t\t\t\t\t@media ( min-width: 768px ) {\r\n\t\t\t\t\t\t\tfont-size: ${ theme.textInputAnswers.lg };\r\n\t\t\t\t\t\t\tline-height: ${ theme.textInputAnswers.lg };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t@media ( max-width: 767px ) {\r\n\t\t\t\t\t\t\tfont-size: ${ theme.textInputAnswers.sm };\r\n\t\t\t\t\t\t\tline-height: ${ theme.textInputAnswers.sm };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t${ attributes?.themeId && backgroundImageCSS }\r\n\t\t\t\t`\r\n\t\t\t) }\r\n\t\t>\r\n\t\t\t<div\r\n\t\t\t\tclassName={ css`\r\n\t\t\t\t\t${ attributes?.themeId &&\r\n\t\t\t\t\t`background: ${ theme.backgroundColor }` };\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\theight: 100%;\r\n\t\t\t\t` }\r\n\t\t\t>\r\n\t\t\t\t{ shouldBeRendered && (\r\n\t\t\t\t\t<section\r\n\t\t\t\t\t\tid={ 'block-' + id }\r\n\t\t\t\t\t\tclassName={ classnames(\r\n\t\t\t\t\t\t\t`blocktype-${ blockName }-block`,\r\n\t\t\t\t\t\t\t`renderer-core-block-${ layout }-layout`,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t'with-attachment':\r\n\t\t\t\t\t\t\t\t\tblockType?.supports.attachment,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName=\"renderer-components-field-wrapper__content-wrapper renderer-components-block__content-wrapper\"\r\n\t\t\t\t\t\t\ttabIndex={ 0 }\r\n\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\tonKeyDown={ ( e: KeyboardEvent ): void => {\r\n\t\t\t\t\t\t\t\tconst isShiftPressed = e.shiftKey;\r\n\t\t\t\t\t\t\t\tif ( isAnimating ) {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif ( e.key === 'Enter' ) {\r\n\t\t\t\t\t\t\t\t\tif ( isValid ) {\r\n\t\t\t\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tshowErrMsg( true );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t//tab?\r\n\t\t\t\t\t\t\t\t\tif ( e.key === 'Tab' ) {\r\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\tonTab( e, isShiftPressed );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tref={ ref }\r\n\t\t\t\t\t\t\t\t{ ...specialProps }\r\n\t\t\t\t\t\t\t\tclassName=\"renderer-core-block-scroller\"\r\n\t\t\t\t\t\t\t\tonScroll={ ( e ) => scrollHandler( e ) }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<FieldContent />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{ ( ( layout !== 'stack' &&\r\n\t\t\t\t\t\t\tdeviceWidth !== 'mobile' ) ||\r\n\t\t\t\t\t\t\t( deviceWidth === 'mobile' &&\r\n\t\t\t\t\t\t\t\t( layout === 'split-left' ||\r\n\t\t\t\t\t\t\t\t\tlayout === 'split-right' ) ) ) &&\r\n\t\t\t\t\t\t\tblockType?.supports?.attachment && (\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tclassName={ classnames(\r\n\t\t\t\t\t\t\t\t\t\t'renderer-core-block-attachment-wrapper',\r\n\t\t\t\t\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\t\t\t\t\timg {\r\n\t\t\t\t\t\t\t\t\t\t\t\tobject-position: ${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tattributes\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.attachmentFocalPoint\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.x * 100\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t }%\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tattributes\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.attachmentFocalPoint\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.y * 100\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t }%;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<BlockAttachment />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t</section>\r\n\t\t\t\t) }\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default FieldWrapper;\r\n"],"mappings":"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"}