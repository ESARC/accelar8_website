{"version":3,"names":["_element","require","_data","_classnames","_interopRequireDefault","_reactLoaderSpinner","_emotion","_button","_htmlParser","_hooks","_fieldRender","SubmitBtn","messages","useMessages","isLastField","isActive","attributes","__experimentalUseFieldRenderContext","theme","useBlockTheme","themeId","goToBlock","goNext","setIsReviewing","setIsSubmitting","setIsFieldValid","setFieldValidationErr","setSubmissionErr","completeForm","setIsCurrentBlockSafeToSwipe","setIsFieldPending","useDispatch","onSubmit","beforeGoingNext","useFormContext","isWaitingPending","setIsWaitingPending","useState","answers","firstInvalidFieldId","pendingMsg","isSubmitting","submissionErr","currentBlockId","useSelect","select","getCurrentBlockId","getAnswers","getPendingMsg","getFirstInvalidFieldId","getSubmissionErr","handleKeyDown","e","key","metaKey","submitHandler","goToFirstInvalidField","useEffect","window","addEventListener","removeEventListener","setIsPending","val","reviewAndSubmit","setTimeout","createElement","className","default","onClick","onKeyDown","stopPropagation","value","TailSpin","wrapperClass","color","height","width","classNames","css","questionsColor","_default","exports"],"sources":["@quillforms/renderer-core/src/components/submit-btn/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useState } from '@wordpress/element';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport classNames from 'classnames';\r\nimport { TailSpin as Loader } from 'react-loader-spinner';\r\nimport { css } from 'emotion';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport Button from '../button';\r\nimport HTMLParser from '../html-parser';\r\nimport { useBlockTheme, useFormContext, useMessages } from '../../hooks';\r\nimport { __experimentalUseFieldRenderContext } from '../field-render';\r\n\r\nconst SubmitBtn: React.FC = () => {\r\n\tconst messages = useMessages();\r\n\tconst { isLastField, isActive, attributes } =\r\n\t\t__experimentalUseFieldRenderContext();\r\n\tconst theme = useBlockTheme( attributes?.themeId );\r\n\r\n\tconst {\r\n\t\tgoToBlock,\r\n\t\tgoNext,\r\n\t\tsetIsReviewing,\r\n\t\tsetIsSubmitting,\r\n\t\tsetIsFieldValid,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetSubmissionErr,\r\n\t\tcompleteForm,\r\n\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\tsetIsFieldPending,\r\n\t} = useDispatch( 'quillForms/renderer-core' );\r\n\tconst { onSubmit, beforeGoingNext } = useFormContext();\r\n\tconst [ isWaitingPending, setIsWaitingPending ] = useState( false );\r\n\r\n\tconst {\r\n\t\tanswers,\r\n\t\tfirstInvalidFieldId,\r\n\t\tpendingMsg,\r\n\t\tisSubmitting,\r\n\t\tsubmissionErr,\r\n\t\tcurrentBlockId,\r\n\t} = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tcurrentBlockId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getCurrentBlockId(),\r\n\t\t\tanswers: select( 'quillForms/renderer-core' ).getAnswers(),\r\n\t\t\tpendingMsg: select( 'quillForms/renderer-core' ).getPendingMsg(),\r\n\t\t\tisSubmitting: select( 'quillForms/renderer-core' ).isSubmitting(),\r\n\t\t\tfirstInvalidFieldId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getFirstInvalidFieldId(),\r\n\t\t\tsubmissionErr: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getSubmissionErr(),\r\n\t\t};\r\n\t} );\r\n\r\n\r\n\tif ( ! currentBlockId ) return null;\r\n\r\n\tconst handleKeyDown = ( e ) => {\r\n\t\tif ( e.key === 'Enter' ) {\r\n\t\t\tif ( e.metaKey ) {\r\n\t\t\t\tsubmitHandler();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst goToFirstInvalidField = () => {\r\n\t\tif ( firstInvalidFieldId ) goToBlock( firstInvalidFieldId );\r\n\t};\r\n\tuseEffect( () => {\r\n\t\tif ( isLastField && isActive ) {\r\n\t\t\tsetIsReviewing( false );\r\n\t\t\twindow.addEventListener( 'keydown', handleKeyDown );\r\n\t\t} else {\r\n\t\t\tremoveEventListener( 'keydown', handleKeyDown );\r\n\t\t}\r\n\r\n\t\treturn () => removeEventListener( 'keydown', handleKeyDown );\r\n\t}, [ isLastField, isActive ] );\r\n\r\n\tconst submitHandler = async () => {\r\n\t\tif ( beforeGoingNext && currentBlockId ) {\r\n\t\t\tawait beforeGoingNext( {\r\n\t\t\t\tanswers,\r\n\t\t\t\tsetIsFieldValid,\r\n\t\t\t\tsetFieldValidationErr,\r\n\t\t\t\tgoToBlock,\r\n\t\t\t\tcurrentBlockId,\r\n\t\t\t\tgoNext,\r\n\t\t\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\t\t\tsetIsPending: ( val ) =>\r\n\t\t\t\t\tsetIsFieldPending( currentBlockId, val ),\r\n\t\t\t} );\r\n\t\t}\r\n\t\tif ( pendingMsg === false ) {\r\n\t\t\treviewAndSubmit();\r\n\t\t} else {\r\n\t\t\tsetIsWaitingPending( true );\r\n\t\t}\r\n\t};\r\n\r\n\tconst reviewAndSubmit = () => {\r\n\t\tsetIsReviewing( false );\r\n\t\tif ( firstInvalidFieldId ) {\r\n\t\t\tsetTimeout( () => {\r\n\t\t\t\tsetIsReviewing( true );\r\n\t\t\t}, 50 );\r\n\r\n\t\t\tsetTimeout( () => {\r\n\t\t\t\tgoToFirstInvalidField();\r\n\t\t\t}, 100 );\r\n\t\t} else {\r\n\t\t\tsetIsSubmitting( true );\r\n\t\t\tonSubmit(\r\n\t\t\t\t{ answers },\r\n\t\t\t\t{\r\n\t\t\t\t\tsetIsSubmitting,\r\n\t\t\t\t\tsetIsFieldValid,\r\n\t\t\t\t\tsetFieldValidationErr,\r\n\t\t\t\t\tsetIsReviewing,\r\n\t\t\t\t\tgoToBlock,\r\n\t\t\t\t\tcompleteForm,\r\n\t\t\t\t\tsetSubmissionErr,\r\n\t\t\t\t\tsetIsPending: ( val ) =>\r\n\t\t\t\t\t\tsetIsFieldPending( currentBlockId, val ),\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isWaitingPending && pendingMsg === false ) {\r\n\t\t\tsetIsWaitingPending( false );\r\n\t\t\treviewAndSubmit();\r\n\t\t}\r\n\t}, [ isWaitingPending, pendingMsg ] );\r\n\r\n\treturn (\r\n\t\t<div className=\"renderer-core-submit-btn-wrapper\">\r\n\t\t\t<Button\r\n\t\t\t\tclassName=\"renderer-core-submit-btn\"\r\n\t\t\t\tonClick={ () => {\r\n\t\t\t\t\tif ( ! isSubmitting ) submitHandler();\r\n\t\t\t\t} }\r\n\t\t\t\tonKeyDown={ ( e ) => {\r\n\t\t\t\t\tif ( e.key === 'Enter' ) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tif ( ! isSubmitting ) submitHandler();\r\n\t\t\t\t\t}\r\n\t\t\t\t} }\r\n\t\t\t\ttheme={ theme }\r\n\t\t\t>\r\n\t\t\t\t<HTMLParser\r\n\t\t\t\t\tvalue={\r\n\t\t\t\t\t\tisWaitingPending\r\n\t\t\t\t\t\t\t? pendingMsg\r\n\t\t\t\t\t\t\t\t? pendingMsg\r\n\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t\t: messages[ 'label.submitBtn' ]\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t\t{ ( isWaitingPending || isSubmitting ) && (\r\n\t\t\t\t\t<Loader\r\n\t\t\t\t\t\twrapperClass=\"renderer-core-submit-btn__loader\"\r\n\t\t\t\t\t\tcolor=\"#fff\"\r\n\t\t\t\t\t\theight={ 20 }\r\n\t\t\t\t\t\twidth={ 20 }\r\n\t\t\t\t\t/>\r\n\t\t\t\t) }\r\n\t\t\t</Button>\r\n\t\t\t{ submissionErr && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={ classNames(\r\n\t\t\t\t\t\t'renderer-core-submit-error',\r\n\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\tcolor: ${ theme.questionsColor };\r\n\t\t\t\t\t\t\tmargin-top: 15px;\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t) }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ submissionErr }\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default SubmitBtn;\r\n"],"mappings":"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"}