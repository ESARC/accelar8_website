{"version":3,"names":["_element","require","_data","_hooks","_emotion","_fieldRender","_useBlockTypes","_interopRequireDefault","_fieldFooter","_useFormContext","_useHandleFocus","_useBlockTheme","timer1","timer2","FieldDisplayWrapper","_ref","isShaking","setIsShaking","inputRef","useRef","id","next","blockName","isActive","attributes","showNextBtn","showErrMsg","innerBlocks","__experimentalUseFieldRenderContext","theme","useBlockTheme","themeId","isTouchScreen","window","navigator","maxTouchPoints","msMaxTouchPoints","useHandleFocus","isPreview","formId","useFormContext","blockTypes","useBlockTypes","blockType","shakingErr","setShakingErr","useState","isCurrentBlockEditable","isReviewing","useSelect","select","hasBlockSupport","answerValue","isAnswered","isValid","isPending","getFieldAnswerVal","isAnsweredField","isValidField","isFieldPending","clearTimers","clearTimeout","useEffect","setFooterDisplay","shakeWithError","err","setTimeout","action","doAction","label","setIsFieldValid","setFieldValidationErr","setIsFieldAnswered","setIsFieldPending","setFieldPendingMsg","setFieldAnswer","useDispatch","props","val","setIsValid","setIsAnswered","setIsPending","setPendingMsg","setValidationErr","setVal","blockWithError","createElement","role","className","display","css","typographyPreset","default","_default","exports"],"sources":["@quillforms/renderer-core/src/components/field-display-wrapper/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useState, useRef } from '@wordpress/element';\r\nimport { doAction } from '@wordpress/hooks';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { css } from 'emotion';\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { __experimentalUseFieldRenderContext } from '../field-render';\r\nimport useBlockTypes from '../../hooks/use-block-types';\r\nimport BlockFooter from '../field-footer';\r\nimport useFormContext from '../../hooks/use-form-context';\r\nimport useHandleFocus from '../../hooks/use-handle-focus';\r\nimport useBlockTheme from '../../hooks/use-block-theme';\r\ninterface Props {\r\n\tsetIsShaking: ( value: boolean ) => void;\r\n\tisShaking: boolean;\r\n}\r\nlet timer1: ReturnType< typeof setTimeout >,\r\n\ttimer2: ReturnType< typeof setTimeout >;\r\n\r\nconst FieldDisplayWrapper: React.FC< Props > = ( {\r\n\tisShaking,\r\n\tsetIsShaking,\r\n} ) => {\r\n\tconst inputRef = useRef( null );\r\n\tconst {\r\n\t\tid,\r\n\t\tnext,\r\n\t\tblockName,\r\n\t\tisActive,\r\n\t\tattributes,\r\n\t\tshowNextBtn,\r\n\t\tshowErrMsg,\r\n\t\tinnerBlocks,\r\n\t} = __experimentalUseFieldRenderContext();\r\n\tconst theme = useBlockTheme( attributes?.themeId );\r\n\r\n\tconst isTouchScreen =\r\n\t\t( typeof window !== 'undefined' && 'ontouchstart' in window ) ||\r\n\t\t( typeof navigator !== 'undefined' && navigator.maxTouchPoints > 0 ) ||\r\n\t\t// @ts-expect-error\r\n\t\t( typeof navigator !== 'undefined' && navigator.msMaxTouchPoints > 0 );\r\n\r\n\tuseHandleFocus( inputRef, isActive, isTouchScreen );\r\n\tconst { isPreview, formId } = useFormContext();\r\n\r\n\tif ( ! blockName || ! id ) return null;\r\n\tconst blockTypes = useBlockTypes();\r\n\tconst blockType = blockTypes[ blockName ];\r\n\tconst [ shakingErr, setShakingErr ] = useState( null );\r\n\r\n\tconst { isCurrentBlockEditable, isReviewing } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tisCurrentBlockEditable: select(\r\n\t\t\t\t'quillForms/blocks'\r\n\t\t\t).hasBlockSupport( blockName, 'editable' ),\r\n\t\t\tisReviewing: select( 'quillForms/renderer-core' ).isReviewing(),\r\n\t\t};\r\n\t} );\r\n\tconst { answerValue, isAnswered, isValid, isPending } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\treturn {\r\n\t\t\t\tanswerValue: isCurrentBlockEditable\r\n\t\t\t\t\t? select( 'quillForms/renderer-core' ).getFieldAnswerVal(\r\n\t\t\t\t\t\t\tid\r\n\t\t\t\t\t  )\r\n\t\t\t\t\t: null,\r\n\t\t\t\tisAnswered: isCurrentBlockEditable\r\n\t\t\t\t\t? select( 'quillForms/renderer-core' ).isAnsweredField( id )\r\n\t\t\t\t\t: null,\r\n\t\t\t\tisValid: isCurrentBlockEditable\r\n\t\t\t\t\t? select( 'quillForms/renderer-core' ).isValidField( id )\r\n\t\t\t\t\t: null,\r\n\t\t\t\tisPending: select( 'quillForms/renderer-core' ).isFieldPending(\r\n\t\t\t\t\tid\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t}\r\n\t);\r\n\r\n\tconst clearTimers = () => {\r\n\t\tclearTimeout( timer1 );\r\n\t\tclearTimeout( timer2 );\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tclearTimers();\r\n\t\tsetIsShaking( false );\r\n\t\tif ( shakingErr ) setShakingErr( null );\r\n\t}, [ answerValue ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! isActive ) {\r\n\t\t\tclearTimers();\r\n\t\t\tsetIsShaking( false );\r\n\t\t\tif ( shakingErr ) setShakingErr( null );\r\n\t\t}\r\n\r\n\t\tif ( isActive ) {\r\n\t\t\tsetFooterDisplay( true );\r\n\t\t}\r\n\t}, [ isActive ] );\r\n\r\n\tconst shakeWithError = ( err ) => {\r\n\t\tclearTimers();\r\n\t\tif ( ! isShaking ) setIsShaking( true );\r\n\t\tif ( ! shakingErr ) setShakingErr( err );\r\n\t\ttimer1 = setTimeout( () => {\r\n\t\t\tsetIsShaking( false );\r\n\t\t}, 600 );\r\n\t\ttimer2 = setTimeout( () => {\r\n\t\t\tsetShakingErr( null );\r\n\t\t}, 1200 );\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isAnswered ) {\r\n\t\t\tconst action = isActive\r\n\t\t\t\t? 'QuillForms.RendererCore.FieldAnsweredActive'\r\n\t\t\t\t: 'QuillForms.RendererCore.FieldAnswered';\r\n\t\t\tdoAction( action, {\r\n\t\t\t\tformId,\r\n\t\t\t\tid,\r\n\t\t\t\tlabel: attributes?.label,\r\n\t\t\t} );\r\n\t\t}\r\n\t}, [ isAnswered, isActive ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isActive ) {\r\n\t\t\tdoAction( 'QuillForms.RendererCore.FieldActive', {\r\n\t\t\t\tformId,\r\n\t\t\t\tid,\r\n\t\t\t\tlabel: attributes?.label,\r\n\t\t\t} );\r\n\t\t}\r\n\t}, [ isActive ] );\r\n\r\n\tconst {\r\n\t\tsetIsFieldValid,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetIsFieldAnswered,\r\n\t\tsetIsFieldPending,\r\n\t\tsetFieldPendingMsg,\r\n\t\tsetFieldAnswer,\r\n\t\tsetFooterDisplay,\r\n\t} = useDispatch( 'quillForms/renderer-core' );\r\n\r\n\tconst props = {\r\n\t\tid,\r\n\t\tnext,\r\n\t\tattributes,\r\n\t\tisValid,\r\n\t\tisPending,\r\n\t\tinnerBlocks,\r\n\t\tisReviewing,\r\n\t\tval: answerValue,\r\n\t\tsetIsValid: ( val: boolean ) => setIsFieldValid( id, val ),\r\n\t\tsetIsAnswered: ( val: boolean ) => setIsFieldAnswered( id, val ),\r\n\t\tsetIsPending: ( val: boolean ) => setIsFieldPending( id, val ),\r\n\t\tsetPendingMsg: ( val: string ) => setFieldPendingMsg( id, val ),\r\n\t\tsetValidationErr: ( val: string ) => setFieldValidationErr( id, val ),\r\n\t\tsetVal: ( val: string ) => setFieldAnswer( id, val ),\r\n\t\tshowNextBtn,\r\n\t\tblockWithError: ( err: string ) => shakeWithError( err ),\r\n\t\tshowErrMsg,\r\n\t\tisPreview,\r\n\t\tisTouchScreen,\r\n\t\tinputRef,\r\n\t\tsetFooterDisplay,\r\n\t\tformId,\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\trole=\"presentation\"\r\n\t\t\tclassName=\"renderer-core-field-display-wrapper\"\r\n\t\t>\r\n\t\t\t{ blockType?.display && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={ css`\r\n\t\t\t\t\t\t@media ( max-width: 767px ) {\r\n\t\t\t\t\t\t\tmargin-top: ${ theme.typographyPreset === 'sm'\r\n\t\t\t\t\t\t\t\t? `24px`\r\n\t\t\t\t\t\t\t\t: `32px` };\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t@media ( min-width: 768px ) {\r\n\t\t\t\t\t\t\tmargin-top: ${ theme.typographyPreset === 'sm'\r\n\t\t\t\t\t\t\t\t? `24px`\r\n\t\t\t\t\t\t\t\t: theme.typographyPreset === 'lg'\r\n\t\t\t\t\t\t\t\t? `40px`\r\n\t\t\t\t\t\t\t\t: `32px` };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t` }\r\n\t\t\t\t>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t/* @ts-expect-error */\r\n\t\t\t\t\t\t<blockType.display { ...props } />\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t\t<BlockFooter shakingErr={ shakingErr } isPending={ isPending } />\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default FieldDisplayWrapper;\r\n"],"mappings":"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"}