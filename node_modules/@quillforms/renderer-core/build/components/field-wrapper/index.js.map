{"version":3,"names":["_element","require","_extends2","_interopRequireDefault","_useBlockTheme","_data","_classnames","_emotion","_context","_fieldContent","_lodash","_useFormSettings","_fieldAttachment","_hooks","scrollTimer","tabTimer","FieldWrapper","_attributes$layout","_attributes$classname","id","isActive","shouldBeRendered","showErrMsg","next","attributes","blockName","__experimentalUseFieldRenderContext","deviceWidth","useFormContext","settings","useFormSettings","blockType","useSelect","select","getBlockType","swiper","isValid","isFocused","getSwiperState","supports","innerBlocks","hasValidFields","editable","isValidField","setSwiper","goPrev","setIsCurrentBlockSafeToSwipe","useDispatch","walkPath","currentBlockId","isAnimating","isReviewing","setCanSwipeNext","val","canSwipeNext","setCanSwipePrev","canSwipePrev","fieldIndex","findIndex","field","currentFieldIndex","$field","position","ref","useRef","useEffect","setTimeout","current","scrollTo","clearTimeout","focusableElementsString","getFocusables","el","filter","Array","prototype","slice","call","document","querySelector","querySelectorAll","item","getAttribute","offsetParent","window","getComputedStyle","visibility","processTab","isShiftPressed","activeElement","focusableElements","activeElementIndex","length","contains","focus","body","onTab","e","preventDefault","scrollHandler","disableWheelSwiping","animationDirection","scrollTop","Math","abs","scrollHeight","clientHeight","layout","displayLayout","theme","useBlockTheme","themeId","backgroundImageCSS","backgroundImage","parseFloat","backgroundImageFocalPoint","x","y","specialProps","createElement","className","classnames","active","typographyPreset","css","font","fontSize","lg","fontLineHeight","sm","textInputAnswers","backgroundColor","attachment","tabIndex","onKeyDown","shiftKey","key","stopPropagation","default","onScroll","attachmentFocalPoint","_default","exports"],"sources":["@quillforms/renderer-core/src/components/field-wrapper/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * QuillForms Dependencies\r\n */\r\nimport useBlockTheme from '../../hooks/use-block-theme';\r\n\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useRef, useEffect } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport classnames from 'classnames';\r\nimport { css } from 'emotion';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { __experimentalUseFieldRenderContext } from '../field-render/context';\r\nimport FieldContent from '../field-content';\r\nimport { filter, findIndex } from 'lodash';\r\nimport useFormSettings from '../../hooks/use-form-settings';\r\nimport BlockAttachment from '../field-attachment';\r\nimport { useFormContext } from '../../hooks';\r\n\r\nlet scrollTimer: ReturnType< typeof setTimeout >;\r\nlet tabTimer: ReturnType< typeof setTimeout >;\r\n\r\nconst FieldWrapper: React.FC = () => {\r\n\tconst {\r\n\t\tid,\r\n\t\tisActive,\r\n\t\tshouldBeRendered,\r\n\t\tshowErrMsg,\r\n\t\tnext,\r\n\t\tattributes,\r\n\t\tblockName,\r\n\t} = __experimentalUseFieldRenderContext();\r\n\tconst { deviceWidth } = useFormContext();\r\n\r\n\tconst settings = useFormSettings();\r\n\tif ( ! id || ! blockName ) return null;\r\n\tconst { blockType } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tblockType: select( 'quillForms/blocks' ).getBlockType( blockName ),\r\n\t\t};\r\n\t} );\r\n\r\n\tif ( ! blockType ) return null;\r\n\tconst { swiper, isValid, isFocused } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tswiper: select( 'quillForms/renderer-core' ).getSwiperState(),\r\n\t\t\tisValid: blockType?.supports?.innerBlocks\r\n\t\t\t\t? select( 'quillForms/renderer-core' ).hasValidFields( id )\r\n\t\t\t\t: blockType?.supports?.editable\r\n\t\t\t\t? select( 'quillForms/renderer-core' ).isValidField( id )\r\n\t\t\t\t: true,\r\n\t\t\tisFocused: select( 'quillForms/renderer-core' ).isFocused(),\r\n\t\t};\r\n\t} );\r\n\r\n\tconst { setSwiper, goPrev, setIsCurrentBlockSafeToSwipe } = useDispatch(\r\n\t\t'quillForms/renderer-core'\r\n\t);\r\n\r\n\tconst { walkPath, currentBlockId, isAnimating, isReviewing } = swiper;\r\n\tconst setCanSwipeNext = ( val: boolean ) => {\r\n\t\t// if ( walkPath[ walkPath.length - 1 ].id === id ) val = false;\r\n\t\tsetSwiper( {\r\n\t\t\tcanSwipeNext: val,\r\n\t\t} );\r\n\t};\r\n\tconst setCanSwipePrev = ( val: boolean ) => {\r\n\t\tsetSwiper( {\r\n\t\t\tcanSwipePrev: val,\r\n\t\t} );\r\n\t};\r\n\r\n\tconst fieldIndex = walkPath.findIndex( ( field ) => field.id === id );\r\n\r\n\tconst currentFieldIndex = walkPath.findIndex(\r\n\t\t( $field ) => $field.id === currentBlockId\r\n\t);\r\n\r\n\tconst position = isActive\r\n\t\t? null\r\n\t\t: currentFieldIndex > fieldIndex\r\n\t\t? 'is-up'\r\n\t\t: 'is-down';\r\n\r\n\tconst ref = useRef< HTMLDivElement | null >( null );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isActive && ! isReviewing ) {\r\n\t\t\tsetTimeout( () => {\r\n\t\t\t\tsetIsCurrentBlockSafeToSwipe( true );\r\n\t\t\t}, 40 );\r\n\t\t}\r\n\t}, [ isActive, isReviewing ] );\r\n\tuseEffect( () => {\r\n\t\tif ( isActive ) {\r\n\t\t\tif ( ref?.current ) {\r\n\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\tif ( ref?.current ) {\r\n\t\t\t\t\t\tref.current.scrollTo( 0, 0 );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetCanSwipePrev( true );\r\n\t\t\t\t}, 0 );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tclearTimeout( tabTimer );\r\n\t\t\tclearTimeout( scrollTimer );\r\n\t\t\tsetCanSwipeNext( true );\r\n\t\t\tsetCanSwipePrev( true );\r\n\t\t}\r\n\t}, [ isActive ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isAnimating ) clearTimeout( tabTimer );\r\n\t}, [ isAnimating ] );\r\n\r\n\tconst focusableElementsString =\r\n\t\t'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex=\"0\"], [contenteditable]';\r\n\r\n\t/**\r\n\t * Gets all the focusable elements inside the passed element.\r\n\t *\r\n\t * @param  el\r\n\t */\r\n\tfunction getFocusables( el ) {\r\n\t\treturn filter(\r\n\t\t\tArray.prototype.slice.call(\r\n\t\t\t\tdocument\r\n\t\t\t\t\t.querySelector( el )\r\n\t\t\t\t\t.querySelectorAll( focusableElementsString )\r\n\t\t\t),\r\n\t\t\t( item ) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\titem.getAttribute( 'tabindex' ) !== '-1' &&\r\n\t\t\t\t\t//are also not hidden elements (or with hidden parents)\r\n\t\t\t\t\titem.offsetParent !== null &&\r\n\t\t\t\t\twindow.getComputedStyle( item ).visibility !== 'hidden'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tfunction processTab( isShiftPressed ) {\r\n\t\tif ( isAnimating ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst activeElement = document.activeElement;\r\n\t\tconst focusableElements = getFocusables( `#block-${ id }` );\r\n\t\t//outside the block? Let's not hijack the tab!\r\n\t\tif ( ! isFocused ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst activeElementIndex = findIndex(\r\n\t\t\tfocusableElements,\r\n\t\t\t( el ) => el === activeElement\r\n\t\t);\r\n\r\n\t\t// Happens when the active element is in the next block or previous block\r\n\t\t// This case occurs when pressing tab multiple times at the same time.\r\n\t\tif ( activeElementIndex === -1 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif ( ! isShiftPressed ) {\r\n\t\t\tif (\r\n\t\t\t\tactiveElement ==\r\n\t\t\t\tfocusableElements[ focusableElements.length - 1 ]\r\n\t\t\t) {\r\n\t\t\t\tnext();\r\n\t\t\t} else if (\r\n\t\t\t\tfocusableElements[ activeElementIndex + 1 ].offsetParent !==\r\n\t\t\t\t\tnull &&\r\n\t\t\t\t// If document element is still in dom\r\n\t\t\t\t// One example for this case is  the next button in each block if the block isn't valid and the error message\r\n\t\t\t\t// appear instead of the button. The button is focusable but it is no longer in dom.\r\n\t\t\t\tdocument.contains( focusableElements[ activeElementIndex + 1 ] )\r\n\t\t\t) {\r\n\t\t\t\tfocusableElements[ activeElementIndex + 1 ].focus();\r\n\t\t\t} else {\r\n\t\t\t\t//when reached the last focusable element of the block, go next\r\n\t\t\t\tnext();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//when reached the first  focusable element of the block, go prev if shift is pressed\r\n\t\t\tif ( activeElementIndex === 0 ) {\r\n\t\t\t\tgoPrev();\r\n\t\t\t} else if ( activeElementIndex === -1 ) {\r\n\t\t\t\tdocument.body.focus();\r\n\t\t\t} else {\r\n\t\t\t\tfocusableElements[ activeElementIndex - 1 ].focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Makes sure the tab key will only focus elements within the current block  preventing this way from breaking the page.\r\n\t * Otherwise, go next or prev.\r\n\t *\r\n\t * @param  e\r\n\t * @param  isShiftPressed\r\n\t */\r\n\tfunction onTab( e, isShiftPressed ) {\r\n\t\tclearTimeout( tabTimer );\r\n\t\tif ( isAnimating ) return;\r\n\t\te.preventDefault();\r\n\t\ttabTimer = setTimeout( () => {\r\n\t\t\tprocessTab( isShiftPressed );\r\n\t\t}, 150 );\r\n\t}\r\n\r\n\tconst scrollHandler = ( e ) => {\r\n\t\tif (\r\n\t\t\tsettings?.disableWheelSwiping ||\r\n\t\t\tsettings?.animationDirection === 'horizontal'\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t\tif ( ! ref.current ) return;\r\n\t\tif ( ref.current.scrollTop <= 0 ) {\r\n\t\t\tscrollTimer = setTimeout( () => {\r\n\t\t\t\tsetCanSwipePrev( true );\r\n\t\t\t}, 500 );\r\n\t\t} else {\r\n\t\t\tsetCanSwipePrev( false );\r\n\t\t}\r\n\t\t// Adding tolerance to detect scroll end.\r\n\t\t// It was a problem with mobile devices.\r\n\t\tif (\r\n\t\t\tMath.abs(\r\n\t\t\t\tref.current.scrollHeight -\r\n\t\t\t\t\tref.current.clientHeight -\r\n\t\t\t\t\tref.current.scrollTop\r\n\t\t\t) <= 3.0\r\n\t\t) {\r\n\t\t\tscrollTimer = setTimeout( () => {\r\n\t\t\t\tsetCanSwipeNext( true );\r\n\t\t\t}, 500 );\r\n\t\t} else {\r\n\t\t\tsetCanSwipeNext( false );\r\n\t\t}\r\n\t};\r\n\tconst layout =\r\n\t\tblockType?.displayLayout && blockType?.displayLayout !== 'default'\r\n\t\t\t? blockType.displayLayout\r\n\t\t\t: attributes?.layout ?? 'stack';\r\n\tconst theme = useBlockTheme( attributes?.themeId );\r\n\tlet backgroundImageCSS = '';\r\n\tif ( theme.backgroundImage && theme.backgroundImage ) {\r\n\t\tbackgroundImageCSS = `background-image: url('${\r\n\t\t\ttheme.backgroundImage\r\n\t\t}');\r\n\t\t\tbackground-size: cover;\r\n\t\t\tbackground-position: ${\r\n\t\t\t\t// @ts-expect-error\r\n\t\t\t\tparseFloat( theme.backgroundImageFocalPoint?.x ) * 100\r\n\t\t\t}%\r\n\t\t\t${\r\n\t\t\t\t// @ts-expect-error\r\n\t\t\t\tparseFloat( theme.backgroundImageFocalPoint?.y ) * 100\r\n\t\t\t}%;\r\n\t\t`;\r\n\t}\r\n\r\n\tlet specialProps = {};\r\n\tif ( isActive ) {\r\n\t\tspecialProps = {\r\n\t\t\t'data-iframe-height': true,\r\n\t\t};\r\n\t}\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={ classnames(\r\n\t\t\t\t'renderer-components-field-wrapper',\r\n\t\t\t\t{\r\n\t\t\t\t\tactive: isActive,\r\n\t\t\t\t\t'is-animating': isAnimating,\r\n\t\t\t\t\t'is-horizontal-animation':\r\n\t\t\t\t\t\tsettings?.animationDirection === 'horizontal',\r\n\t\t\t\t},\r\n\t\t\t\t`${ attributes?.classnames ?? '' }`,\r\n\t\t\t\t`${ theme.typographyPreset }-typography-preset`,\r\n\t\t\t\tposition ? position : '',\r\n\t\t\t\tcss`\r\n\t\t\t\t\tfont-family: ${ theme.font };\r\n\t\t\t\t\t@media ( min-width: 768px ) {\r\n\t\t\t\t\t\tfont-size: ${ theme.fontSize.lg };\r\n\t\t\t\t\t\tline-height: ${ theme.fontLineHeight.lg };\r\n\t\t\t\t\t}\r\n\t\t\t\t\t@media ( max-width: 767px ) {\r\n\t\t\t\t\t\tfont-size: ${ theme.fontSize.sm };\r\n\t\t\t\t\t\tline-height: ${ theme.fontLineHeight.sm };\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttextarea,\r\n\t\t\t\t\tinput {\r\n\t\t\t\t\t\tfont-family: ${ theme.font };\r\n\t\t\t\t\t\tbackground: transparent;\r\n\t\t\t\t\t\tbackground-color: transparent;\r\n\r\n\t\t\t\t\t\t@media ( min-width: 768px ) {\r\n\t\t\t\t\t\t\tfont-size: ${ theme.textInputAnswers.lg };\r\n\t\t\t\t\t\t\tline-height: ${ theme.textInputAnswers.lg };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t@media ( max-width: 767px ) {\r\n\t\t\t\t\t\t\tfont-size: ${ theme.textInputAnswers.sm };\r\n\t\t\t\t\t\t\tline-height: ${ theme.textInputAnswers.sm };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t${ attributes?.themeId && backgroundImageCSS }\r\n\t\t\t\t`\r\n\t\t\t) }\r\n\t\t>\r\n\t\t\t<div\r\n\t\t\t\tclassName={ css`\r\n\t\t\t\t\t${ attributes?.themeId &&\r\n\t\t\t\t\t`background: ${ theme.backgroundColor }` };\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\theight: 100%;\r\n\t\t\t\t` }\r\n\t\t\t>\r\n\t\t\t\t{ shouldBeRendered && (\r\n\t\t\t\t\t<section\r\n\t\t\t\t\t\tid={ 'block-' + id }\r\n\t\t\t\t\t\tclassName={ classnames(\r\n\t\t\t\t\t\t\t`blocktype-${ blockName }-block`,\r\n\t\t\t\t\t\t\t`renderer-core-block-${ layout }-layout`,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t'with-attachment':\r\n\t\t\t\t\t\t\t\t\tblockType?.supports.attachment,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName=\"renderer-components-field-wrapper__content-wrapper renderer-components-block__content-wrapper\"\r\n\t\t\t\t\t\t\ttabIndex={ 0 }\r\n\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\tonKeyDown={ ( e: KeyboardEvent ): void => {\r\n\t\t\t\t\t\t\t\tconst isShiftPressed = e.shiftKey;\r\n\t\t\t\t\t\t\t\tif ( isAnimating ) {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif ( e.key === 'Enter' ) {\r\n\t\t\t\t\t\t\t\t\tif ( isValid ) {\r\n\t\t\t\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tshowErrMsg( true );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t//tab?\r\n\t\t\t\t\t\t\t\t\tif ( e.key === 'Tab' ) {\r\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\tonTab( e, isShiftPressed );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tref={ ref }\r\n\t\t\t\t\t\t\t\t{ ...specialProps }\r\n\t\t\t\t\t\t\t\tclassName=\"renderer-core-block-scroller\"\r\n\t\t\t\t\t\t\t\tonScroll={ ( e ) => scrollHandler( e ) }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<FieldContent />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{ ( ( layout !== 'stack' &&\r\n\t\t\t\t\t\t\tdeviceWidth !== 'mobile' ) ||\r\n\t\t\t\t\t\t\t( deviceWidth === 'mobile' &&\r\n\t\t\t\t\t\t\t\t( layout === 'split-left' ||\r\n\t\t\t\t\t\t\t\t\tlayout === 'split-right' ) ) ) &&\r\n\t\t\t\t\t\t\tblockType?.supports?.attachment && (\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tclassName={ classnames(\r\n\t\t\t\t\t\t\t\t\t\t'renderer-core-block-attachment-wrapper',\r\n\t\t\t\t\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\t\t\t\t\timg {\r\n\t\t\t\t\t\t\t\t\t\t\t\tobject-position: ${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tattributes\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.attachmentFocalPoint\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.x * 100\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t }%\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tattributes\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.attachmentFocalPoint\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.y * 100\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t }%;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<BlockAttachment />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t</section>\r\n\t\t\t\t) }\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default FieldWrapper;\r\n"],"mappings":"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"}