{"version":3,"names":["_element","require","_blocks","_utils","_hooks","_formContext","_formWrapper","_interopRequireDefault","_lodash","Form","_ref","formObj","formId","onSubmit","applyLogic","beforeGoingNext","isPreview","customFonts","deviceWidth","setDeviceWidth","useState","useEffect","handleResize","window","innerWidth","addEventListener","removeEventListener","formatFormObj","blocks","sanitizeBlocks","messages","getDefaultMessages","ParsedUrlSearch","URLSearchParams","location","search","substring","settings","disableProgressBar","disableWheelSwiping","disableNavigationArrows","animationDirection","showQuestionsNumbers","showLettersOnAnswers","console","log","map","$block","name","attributes","randomize","_$block$attributes$ch","choices","shuffle","size","get","doAction","createElement","FormContextProvider","value","default","_default","exports"],"sources":["@quillforms/renderer-core/src/components/form-render/index.tsx"],"sourcesContent":["/**\r\n * QuillForms Dependencies\r\n */\r\nimport { sanitizeBlocks } from '@quillforms/blocks';\r\nimport { getDefaultMessages } from '@quillforms/utils';\r\n\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useState, useEffect } from '@wordpress/element';\r\nimport { doAction } from '@wordpress/hooks';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { FormContextProvider } from '../form-context';\r\nimport FormWrapper from '../form-wrapper';\r\nimport type { FormObj, SubmissionDispatchers, CustomFont } from '../../types';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { map, shuffle, size } from 'lodash';\r\n\r\ninterface Props {\r\n\tformId?: number;\r\n\tformObj: FormObj;\r\n\tcustomFonts?: CustomFont[];\r\n\tonSubmit: (data: Object, dispatchers: SubmissionDispatchers) => void;\r\n\tbeforeGoingNext?: ({\r\n\t\tsetIsFieldValid,\r\n\t\tsetIsPending,\r\n\t\tcurrentBlockId,\r\n\t\tanswers,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\tgoToBlock,\r\n\t\tgoNext,\r\n\t}: {\r\n\t\tsetIsFieldValid: (id: string, flag: boolean) => void;\r\n\t\tsetFieldValidationErr: (id: string, err: string) => void;\r\n\t\tsetIsPending: (flag: boolean) => void;\r\n\t\tsetIsCurrentBlockSafeToSwipe: (flag: boolean) => void;\r\n\t\tgoToBlock: (id: string) => void;\r\n\t\tgoNext: () => void;\r\n\t\tcurrentBlockId: string;\r\n\t\tanswers: Record<string, unknown>;\r\n\t}) => void;\r\n\tapplyLogic: boolean;\r\n\tisPreview?: boolean;\r\n}\r\nconst Form: React.FC<Props> = ({\r\n\tformObj,\r\n\tformId,\r\n\tonSubmit,\r\n\tapplyLogic = false,\r\n\tbeforeGoingNext,\r\n\tisPreview = false,\r\n\tcustomFonts\r\n}) => {\r\n\tconst [deviceWidth, setDeviceWidth] = useState('');\r\n\r\n\tuseEffect(() => {\r\n\t\tfunction handleResize() {\r\n\t\t\tif (window.innerWidth < 600) {\r\n\t\t\t\tsetDeviceWidth('mobile');\r\n\t\t\t} else {\r\n\t\t\t\tsetDeviceWidth('desktop');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('resize', handleResize);\r\n\t\thandleResize();\r\n\r\n\t\treturn () => window.removeEventListener('resize', handleResize);\r\n\t}, []);\r\n\r\n\tconst formatFormObj = (): FormObj => {\r\n\t\t// If not in preview mode, sanitize blocks.\r\n\t\t// In preview mode, sanitizing is already done in block editor resolvers.\r\n\t\tif (!isPreview) {\r\n\t\t\tformObj.blocks = sanitizeBlocks(formObj.blocks);\r\n\t\t}\r\n\r\n\t\tformObj.messages = {\r\n\t\t\t...getDefaultMessages(),\r\n\t\t\t...formObj.messages,\r\n\t\t};\r\n\t\tconst ParsedUrlSearch =\r\n\t\t\ttypeof window !== 'undefined'\r\n\t\t\t\t? new URLSearchParams(\r\n\t\t\t\t\twindow?.location?.search?.substring(1)\r\n\t\t\t\t)\r\n\t\t\t\t: '';\r\n\t\tif (!formObj.settings) formObj.settings = {};\r\n\t\tformObj.settings = {\r\n\t\t\tdisableProgressBar: false,\r\n\t\t\tdisableWheelSwiping: false,\r\n\t\t\tdisableNavigationArrows: false,\r\n\t\t\tanimationDirection: 'vertical',\r\n\t\t\tshowQuestionsNumbers: true,\r\n\t\t\tshowLettersOnAnswers: true,\r\n\t\t\t...formObj.settings,\r\n\t\t};\r\n\r\n\t\tconsole.log(formObj);\r\n\t\tformObj.blocks = map(formObj.blocks, ($block) => {\r\n\t\t\tif (\r\n\t\t\t\t(\r\n\t\t\t\t\t$block.name === 'multiple-choice' ||\r\n\t\t\t\t\t$block.name === 'dropdown' ||\r\n\t\t\t\t\t$block.name === 'picture-choice'\r\n\t\t\t\t) &&\r\n\t\t\t\t$block?.attributes?.randomize\r\n\t\t\t\t&& !isPreview\r\n\t\t\t) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...$block,\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t...$block.attributes,\r\n\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\tchoices: shuffle($block?.attributes?.choices ?? [])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn $block;\r\n\t\t})\r\n\r\n\t\t// 'quillforms-redirection' is deprecated and will be removed.\r\n\t\tif (\r\n\t\t\tsize(ParsedUrlSearch) > 0 &&\r\n\t\t\t// @ts-expect-error\r\n\t\t\tParsedUrlSearch?.get('quillforms-shortcode')\r\n\t\t) {\r\n\t\t\tformObj.settings.disableWheelSwiping = true;\r\n\t\t}\r\n\t\treturn formObj;\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!isPreview) {\r\n\t\t\tdoAction('QuillForms.RendererCore.Loaded');\r\n\t\t}\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<FormContextProvider\r\n\t\t\tvalue={{\r\n\t\t\t\tformObj: formatFormObj(),\r\n\t\t\t\tonSubmit,\r\n\t\t\t\tisPreview,\r\n\t\t\t\tformId,\r\n\t\t\t\tbeforeGoingNext,\r\n\t\t\t\tdeviceWidth,\r\n\t\t\t\tcustomFonts\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<FormWrapper applyLogic={applyLogic} />\r\n\t\t</FormContextProvider>\r\n\t);\r\n};\r\n\r\nexport default Form;\r\n"],"mappings":"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"}